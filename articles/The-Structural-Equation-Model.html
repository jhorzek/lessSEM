<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lessSEM">
<title>The-Structural-Equation-Model • lessSEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The-Structural-Equation-Model">
<meta property="og:description" content="lessSEM">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lessSEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/lessSEM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Definition-Variables-and-Multi-Group-SEM.html">Definition-Variables-and-Multi-Group-SEM</a>
    <a class="dropdown-item" href="../articles/General-Purpose-Optimization.html">General-Purpose-Optimization</a>
    <a class="dropdown-item" href="../articles/Mixed-Penalties.html">Mixed Penalties</a>
    <a class="dropdown-item" href="../articles/Parameter-transformations.html">Parameter-transformations</a>
    <a class="dropdown-item" href="../articles/SCAD-and-MCP.html">SCAD-and-MCP</a>
    <a class="dropdown-item" href="../articles/The-Structural-Equation-Model.html">The-Structural-Equation-Model</a>
    <a class="dropdown-item" href="../articles/The-optimizer-interface.html">The-optimizer-interface</a>
    <a class="dropdown-item" href="../articles/log-likelihood-gradients.html">log-likelihood-gradients</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jhorzek/lessSEM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>The-Structural-Equation-Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jhorzek/lessSEM/blob/HEAD/vignettes/The-Structural-Equation-Model.Rmd" class="external-link"><code>vignettes/The-Structural-Equation-Model.Rmd</code></a></small>
      <div class="d-none name"><code>The-Structural-Equation-Model.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jhorzek/lessSEM" class="external-link">lessSEM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: lavaan</span></span>
<span><span class="co">#&gt; This is lavaan 0.6-14</span></span>
<span><span class="co">#&gt; lavaan is FREE software! Please report any bugs.</span></span></code></pre></div>
<p>The lessSEM package comes with a custom implementation of structural
equation models (SEM). This implementation supports
full-information-maximum-likelihood computation in case of missing data
and could also be used by other packages. Identical to <a href="https://github.com/Rjacobucci/regsem" class="external-link">regsem</a> lessSEM also
builds on <a href="https://github.com/yrosseel/lavaan" class="external-link">lavaan</a> to set
up the model. That is, if you are already familiar with lavaan, setting
up models with lessSEM should be relatively easy.</p>
<p>We will use the political democracy example from the sem
documentation of lavaan in the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="co"># see ?lavaan::sem</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a*y2 + b*y3 + c*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a*y6 + b*y7 + c*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 + y6</span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span>
<span></span>
<span><span class="va">lavaanModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="from-lavaan-to-lesssem">From lavaan to lessSEM<a class="anchor" aria-label="anchor" href="#from-lavaan-to-lesssem"></a>
</h2>
<p>To translate the model from lavaan to lessSEM, we have to use the
<code>lessSEM:::.SEMFromLavaan</code> function. Importantly, this
function is not exported by lessSEM. That is, you <em>must</em> use the
three colons as shown above to access this function!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jhorzek/lessSEM" class="external-link">lessSEM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># won't work:</span></span>
<span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dot-SEMFromLavaan.html">.SEMFromLavaan</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in .SEMFromLavaan(lavaanModel = lavaanModel): could not find function ".SEMFromLavaan"</span></span>
<span></span>
<span><span class="co"># will work:</span></span>
<span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-SEMFromLavaan.html">.SEMFromLavaan</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanModel</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">mySEM</span><span class="op">)</span></span>
<span><span class="co">#&gt; Internal C++ model representation of lessSEM</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1796566    1.8182100    1.1907820    1.1745407    1.2509789    1.4713302 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6004746    0.8650430    0.5825389    1.4402477    2.1829448    0.7115901 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3627964    1.3717741    0.0813878    0.1204271    0.4666596    1.8546417 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    7.5813926    4.9556766    3.2245521    2.3130404    4.9681408    3.5600367 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    3.3076854    0.4485989    3.8753039    0.1644633    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -2 log-Likelihood: 3097.6361581071</span></span></code></pre></div>
<p>The <code>lessSEM:::.SEMFromLavaan</code> function comes with some
additional arguments to fine tune the initialization of the model.</p>
<ol style="list-style-type: decimal">
<li>
<code>whichPars</code>: with the <code>whichPars</code> arguments,
we can change which parameters are used in the mySEM created above. By
default, we will use the estimates (<code>whichPars = "est"</code>) of
the lavaan model, but we could also use the starting values
(<code>whichPars = "start"</code>) or supply custom parameter
values</li>
<li>
<code>fit</code>: When <code>fit = TRUE</code>, lessSEM will fit the
model once and compare the fitting function value to that of the
lavaanModel. If you supplied parameters other than “est”, this should be
set to <code>fit = FALSE</code>
</li>
<li>
<code>addMeans</code>: Should a mean structure be added? It is
currenlty recomended to set this to <code>TRUE</code>
</li>
<li>
<code>activeSet</code>: This allows for only using part of the data
set. This can be useful for cross-validation.</li>
<li>
<code>dataSet</code>: This allows for passing a different data set
to mySEM. This can be useful for cross-validation.</li>
</ol>
<p>In most cases, we recommend setting up the model as shown above, with
none of the additional arguments being used.</p>
</div>
<div class="section level2">
<h2 id="working-with-the-rcpp_semcpp-class">Working with the Rcpp_SEMCpp class<a class="anchor" aria-label="anchor" href="#working-with-the-rcpp_semcpp-class"></a>
</h2>
<p>The mySEM object is implemented in C++ to make everything run faster.
The underlying class is <code>Rcpp_SEMCpp</code> and was created using
the wonderful <a href="https://github.com/RcppCore/Rcpp" class="external-link">Rcpp</a> and <a href="https://github.com/RcppCore/RcppArmadillo" class="external-link">RcppArmadillo</a>
packages.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mySEM</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Rcpp_SEMCpp"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "lessSEM"</span></span></code></pre></div>
<p>You can access its elements using the dollar-operator:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySEM</span><span class="op">$</span><span class="va">A</span></span>
<span><span class="co">#&gt;            [,1]     [,2]     [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span></span>
<span><span class="co">#&gt;  [1,] 0.0000000 0.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [2,] 1.4713302 0.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [3,] 0.6004746 0.865043 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [4,] 1.0000000 0.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [5,] 2.1796566 0.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [6,] 1.8182100 0.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [7,] 0.0000000 1.000000 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [8,] 0.0000000 1.190782 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;  [9,] 0.0000000 1.174541 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt; [10,] 0.0000000 1.250979 0.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt; [11,] 0.0000000 0.000000 1.000000    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt; [12,] 0.0000000 0.000000 1.190782    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt; [13,] 0.0000000 0.000000 1.174541    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt; [14,] 0.0000000 0.000000 1.250979    0    0    0    0    0    0     0     0</span></span>
<span><span class="co">#&gt;       [,12] [,13] [,14]</span></span>
<span><span class="co">#&gt;  [1,]     0     0     0</span></span>
<span><span class="co">#&gt;  [2,]     0     0     0</span></span>
<span><span class="co">#&gt;  [3,]     0     0     0</span></span>
<span><span class="co">#&gt;  [4,]     0     0     0</span></span>
<span><span class="co">#&gt;  [5,]     0     0     0</span></span>
<span><span class="co">#&gt;  [6,]     0     0     0</span></span>
<span><span class="co">#&gt;  [7,]     0     0     0</span></span>
<span><span class="co">#&gt;  [8,]     0     0     0</span></span>
<span><span class="co">#&gt;  [9,]     0     0     0</span></span>
<span><span class="co">#&gt; [10,]     0     0     0</span></span>
<span><span class="co">#&gt; [11,]     0     0     0</span></span>
<span><span class="co">#&gt; [12,]     0     0     0</span></span>
<span><span class="co">#&gt; [13,]     0     0     0</span></span>
<span><span class="co">#&gt; [14,]     0     0     0</span></span></code></pre></div>
<p>Note that, identical to regsem, the model is implemented with the RAM
notation (McArdle &amp; McDonald, 1984). If you are not familiar with
this notation, Fox (2006) provides a short introduction. However, you
won’t need to know the details for the time being. Instead, we will
focus on how to get and set the parameters, fit the model, get its
gradients, etc.</p>
<div class="section level3">
<h3 id="accessing-the-parameters">Accessing the Parameters<a class="anchor" aria-label="anchor" href="#accessing-the-parameters"></a>
</h3>
<p>The parameters of the model can be accessed with the
<code>lessSEM:::.getParameters</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">myParameters</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1796566    1.8182100    1.1907820    1.1745407    1.2509789    1.4713302 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6004746    0.8650430    0.5825389    1.4402477    2.1829448    0.7115901 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3627964    1.3717741    0.0813878    0.1204271    0.4666596    1.8546417 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    7.5813926    4.9556766    3.2245521    2.3130404    4.9681408    3.5600367 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    3.3076854    0.4485989    3.8753039    0.1644633    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897</span></span></code></pre></div>
<p>The naming is identical to that of the lavaanModel. By default, the
parameters are returned in the transformed format. This requires some
more explanation: In lessSEM we assume that negative variances are
outside of the parameter space. That is, negative variances are
<strong>not</strong> allowed (this is different from lavaan!). To ensure
that all variances are positive, we use a transformation: Say we are
interested in the variance <code>ind60~~ind60</code>. Internally, there
is a parameter called <code>x1~~x1</code> and this parameter has a
<code>rawValue</code> and a transformed value (called just
<code>value</code>). We can access these values with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySEM</span><span class="op">$</span><span class="fu">getParameters</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           label     value   rawValue location isTransformation</span></span>
<span><span class="co">#&gt; 1     ind60=~x2 2.1796566  2.1796566  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 2     ind60=~x3 1.8182100  1.8182100  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 3             a 1.1907820  1.1907820  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 4             b 1.1745407  1.1745407  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 5             c 1.2509789  1.2509789  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 6   dem60~ind60 1.4713302  1.4713302  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 7   dem65~ind60 0.6004746  0.6004746  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 8   dem65~dem60 0.8650430  0.8650430  Amatrix            FALSE</span></span>
<span><span class="co">#&gt; 9        y1~~y5 0.5825389  0.5825389  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 10       y2~~y4 1.4402477  1.4402477  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 11       y2~~y6 2.1829448  2.1829448  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 12       y3~~y7 0.7115901  0.7115901  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 13       y4~~y8 0.3627964  0.3627964  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 14       y6~~y8 1.3717741  1.3717741  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 15       x1~~x1 0.0813878 -2.5085299  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 16       x2~~x2 0.1204271 -2.1167106  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 17       x3~~x3 0.4666596 -0.7621551  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 18       y1~~y1 1.8546417  0.6176915  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 19       y2~~y2 7.5813926  2.0256969  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 20       y3~~y3 4.9556766  1.6005337  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 21       y4~~y4 3.2245521  1.1707941  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 22       y5~~y5 2.3130404  0.8385629  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 23       y6~~y6 4.9681408  1.6030457  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 24       y7~~y7 3.5600367  1.2697708  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 25       y8~~y8 3.3076854  1.1962487  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 26 ind60~~ind60 0.4485989 -0.8016262  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 27 dem60~~dem60 3.8753039  1.3546241  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 28 dem65~~dem65 0.1644633 -1.8050678  Smatrix            FALSE</span></span>
<span><span class="co">#&gt; 29         x1~1 5.0543838  5.0543838  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 30         x2~1 4.7921946  4.7921946  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 31         x3~1 3.5576898  3.5576898  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 32         y1~1 5.4646667  5.4646667  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 33         y2~1 4.2564429  4.2564429  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 34         y3~1 6.5631103  6.5631103  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 35         y4~1 4.4525330  4.4525330  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 36         y5~1 5.1362519  5.1362519  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 37         y6~1 2.9780741  2.9780741  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 38         y7~1 6.1962639  6.1962639  Mvector            FALSE</span></span>
<span><span class="co">#&gt; 39         y8~1 4.0433897  4.0433897  Mvector            FALSE</span></span></code></pre></div>
<p>For all parameters which are <em>not</em> variances, the
<code>rawValue</code> will be identical to the <code>value</code>. For
variances, the <code>rawValue</code> can be any real value. The
<code>value</code> itself is then computed as <span class="math inline">\(e^{\text{rawValue}}\)</span>; this ensures that
the <code>value</code> is always positive. You can access the raw values
as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1796566    1.8182100    1.1907820    1.1745407    1.2509789    1.4713302 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6004746    0.8650430    0.5825389    1.4402477    2.1829448    0.7115901 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3627964    1.3717741   -2.5085299   -2.1167106   -0.7621551    0.6176915 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    2.0256969    1.6005337    1.1707941    0.8385629    1.6030457    1.2697708 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    1.1962487   -0.8016262    1.3546241   -1.8050678    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897</span></span></code></pre></div>
<p>Note that the raw value for <code>ind60~~ind60</code> is negative
while the transformed value is positive.</p>
</div>
<div class="section level3">
<h3 id="changing-the-parameters">Changing the Parameters<a class="anchor" aria-label="anchor" href="#changing-the-parameters"></a>
</h3>
<p>Being able to change the parameters is essential for fitting a model.
In lessSEM, this is facilitated by the
<code>lessSEM:::.setParameters</code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, let's change one of the parameters:</span></span>
<span><span class="va">myParameters</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># now, let's change the parameters of the model</span></span>
<span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-setParameters.html">.setParameters</a></span><span class="op">(</span>SEM <span class="op">=</span> <span class="va">mySEM</span>, <span class="co"># the model</span></span>
<span>                                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myParameters</span><span class="op">)</span>, <span class="co"># names of the parameters</span></span>
<span>                                  values <span class="op">=</span> <span class="va">myParameters</span>, <span class="co"># values of the parameters </span></span>
<span>                                  raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note that we had to specify if the parameters in
<code>myParameters</code> are given in raw format. Here, we already used
the transformed parameters, so we set <code>raw = FALSE</code>. Using
the raw parameters instead would look as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myParameters</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># first, let's change one of the parameters:</span></span>
<span><span class="va">myParameters</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># now, let's change the parameters of the model</span></span>
<span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-setParameters.html">.setParameters</a></span><span class="op">(</span>SEM <span class="op">=</span> <span class="va">mySEM</span>, <span class="co"># the model</span></span>
<span>                                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myParameters</span><span class="op">)</span>, <span class="co"># names of the parameters</span></span>
<span>                                  values <span class="op">=</span> <span class="va">myParameters</span>, <span class="co"># values of the parameters</span></span>
<span>                                  raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the parameters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1796566    1.8182100    1.0000000    1.1745407    1.2509789    1.4713302 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6004746    0.8650430    0.5825389    1.4402477    2.1829448    0.7115901 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3627964    1.3717741    0.0813878    0.1204271    0.4666596    1.8546417 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    7.5813926    4.9556766    3.2245521    2.3130404    4.9681408    3.5600367 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    3.3076854    0.4485989    3.8753039    0.1644633    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897</span></span></code></pre></div>
<p>Note that <code>a</code> now has the value <code>1</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h2>
<p>To compute the -2-log-likelihood of the model, we use the
<code>lessSEM:::.fit</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-fit.html">.fit</a></span><span class="op">(</span>SEM <span class="op">=</span> <span class="va">mySEM</span><span class="op">)</span></span></code></pre></div>
<p>The -2-log-likelihood can be accessed with:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySEM</span><span class="op">$</span><span class="va">m2LL</span></span>
<span><span class="co">#&gt; [1] 3100.741</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-the-gradients">Computing the gradients<a class="anchor" aria-label="anchor" href="#computing-the-gradients"></a>
</h2>
<p>To compute the gradients, use the
<code>lessSEM:::.getGradients</code> function. Gradients can be computed
for the transformed parameters</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getGradients.html">.getGradients</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ind60=~x2     ind60=~x3             a             b             c </span></span>
<span><span class="co">#&gt;   0.361097622   0.105564095 -32.837359814   2.453232158  17.076222049 </span></span>
<span><span class="co">#&gt;   dem60~ind60   dem65~ind60   dem65~dem60        y1~~y5        y2~~y4 </span></span>
<span><span class="co">#&gt;  -0.450648533  -1.078272542  -5.357920036   0.004650747  -0.157923486 </span></span>
<span><span class="co">#&gt;        y2~~y6        y3~~y7        y4~~y8        y6~~y8        x1~~x1 </span></span>
<span><span class="co">#&gt;  -0.567076177   0.161163293   0.266869495  -0.271533827   0.230054158 </span></span>
<span><span class="co">#&gt;        x2~~x2        x3~~x3        y1~~y1        y2~~y2        y3~~y3 </span></span>
<span><span class="co">#&gt;   0.306685898  -0.093753843  -0.015516535  -0.343353554   0.099359383 </span></span>
<span><span class="co">#&gt;        y4~~y4        y5~~y5        y6~~y6        y7~~y7        y8~~y8 </span></span>
<span><span class="co">#&gt;   0.137753880   0.131454473  -0.330083693   0.073331567   0.148964628 </span></span>
<span><span class="co">#&gt;  ind60~~ind60  dem60~~dem60  dem65~~dem65          x1~1          x2~1 </span></span>
<span><span class="co">#&gt;  -0.103960291  -0.252921392  -1.955349241   0.000000000   0.000000000 </span></span>
<span><span class="co">#&gt;          x3~1          y1~1          y2~1          y3~1          y4~1 </span></span>
<span><span class="co">#&gt;   0.000000000   0.000000000   0.000000000   0.000000000   0.000000000 </span></span>
<span><span class="co">#&gt;          y5~1          y6~1          y7~1          y8~1 </span></span>
<span><span class="co">#&gt;   0.000000000   0.000000000   0.000000000   0.000000000</span></span></code></pre></div>
<p>or for the raw parameters</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getGradients.html">.getGradients</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ind60=~x2     ind60=~x3             a             b             c </span></span>
<span><span class="co">#&gt;   0.361097622   0.105564095 -32.837359814   2.453232158  17.076222049 </span></span>
<span><span class="co">#&gt;   dem60~ind60   dem65~ind60   dem65~dem60        y1~~y5        y2~~y4 </span></span>
<span><span class="co">#&gt;  -0.450648533  -1.078272542  -5.357920036   0.004650747  -0.157923486 </span></span>
<span><span class="co">#&gt;        y2~~y6        y3~~y7        y4~~y8        y6~~y8        x1~~x1 </span></span>
<span><span class="co">#&gt;  -0.567076177   0.161163293   0.266869495  -0.271533827   0.018723602 </span></span>
<span><span class="co">#&gt;        x2~~x2        x3~~x3        y1~~y1        y2~~y2        y3~~y3 </span></span>
<span><span class="co">#&gt;   0.036933297  -0.043751134  -0.028777612  -2.603098086   0.492392971 </span></span>
<span><span class="co">#&gt;        y4~~y4        y5~~y5        y6~~y6        y7~~y7        y8~~y8 </span></span>
<span><span class="co">#&gt;   0.444194569   0.304059508  -1.639902248   0.261063066   0.492728130 </span></span>
<span><span class="co">#&gt;  ind60~~ind60  dem60~~dem60  dem65~~dem65          x1~1          x2~1 </span></span>
<span><span class="co">#&gt;  -0.046636468  -0.980147244  -0.321583201   0.000000000   0.000000000 </span></span>
<span><span class="co">#&gt;          x3~1          y1~1          y2~1          y3~1          y4~1 </span></span>
<span><span class="co">#&gt;   0.000000000   0.000000000   0.000000000   0.000000000   0.000000000 </span></span>
<span><span class="co">#&gt;          y5~1          y6~1          y7~1          y8~1 </span></span>
<span><span class="co">#&gt;   0.000000000   0.000000000   0.000000000   0.000000000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-the-hessian">Computing the Hessian<a class="anchor" aria-label="anchor" href="#computing-the-hessian"></a>
</h2>
<p>To compute the Hessian, use the <code>lessSEM:::.getHessian</code>
function. The Hessian can be computed for the transformed parameters</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getHessian.html">.getHessian</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>or for the raw parameters</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getHessian.html">.getHessian</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-the-scores">Computing the Scores<a class="anchor" aria-label="anchor" href="#computing-the-scores"></a>
</h2>
<p>To compute the scores (derivative of the -2-log-likelihood for each
person), use the <code>lessSEM:::.getScores</code> function. The scores
can be computed for the transformed parameters</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getScores.html">.getScores</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>or for the raw parameters</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getScores.html">.getScores</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-lesssem-with-general-purpose-optimizers">Using lessSEM with general purpose optimizers<a class="anchor" aria-label="anchor" href="#using-lesssem-with-general-purpose-optimizers"></a>
</h2>
<p>The most important part about the whole SEM implementation mentioned
above is that we can use it flexibly with different optimizers. For
instance, we may want to try out the BFGS optimizer from optim.</p>
<p><strong>Important</strong>: We highly recommend that you use the raw
parameters for any optimization. Using the non-raw parameters can cause
errors and unnecessary headaches!</p>
<p>Let’s have a look at the <code>optim</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">optim</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (par, fn, gr = NULL, ..., method = c("Nelder-Mead", </span></span>
<span><span class="co">#&gt;     "BFGS", "CG", "L-BFGS-B", "SANN", "Brent"), lower = -Inf, </span></span>
<span><span class="co">#&gt;     upper = Inf, control = list(), hessian = FALSE) </span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Note that the function requires a <code>par</code> argument - the
parameter estimates - a <code>fn</code> argument - the fitting function
- and also allows for the gradients to be passed to the function using
the <code>gr</code> argument. We could build such functions based on the
<code>lessSEM:::.fit</code> and <code>lessSEM:::.getGradients</code>
functions shown above, however for convenience such wrappers are already
implemented in lessSEM. The fitting function is called with
<code>lessSEM:::.fitFunction</code> and the gradient function is called
<code>lessSEM:::.gradientFunction</code>. Both expect a vector with
parameters, a SEM, and an argument specifying if the parameters are in
raw format.</p>
<p>We can use this in optim as follows:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's get the starting values:</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># important: Use raw = TRUE!</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1796566    1.8182100    1.0000000    1.1745407    1.2509789    1.4713302 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6004746    0.8650430    0.5825389    1.4402477    2.1829448    0.7115901 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3627964    1.3717741   -2.5085299   -2.1167106   -0.7621551    0.6176915 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    2.0256969    1.6005337    1.1707941    0.8385629    1.6030457    1.2697708 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    1.1962487   -0.8016262    1.3546241   -1.8050678    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897</span></span>
<span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span>par <span class="op">=</span> <span class="va">par</span>, </span>
<span>             fn <span class="op">=</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="va"><a href="../reference/dot-fitFunction.html">.fitFunction</a></span>, <span class="co"># use the fitting function wrapper</span></span>
<span>             gr <span class="op">=</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="va"><a href="../reference/dot-gradientFunction.html">.gradientFunction</a></span>, <span class="co"># use the gradient function wrapper</span></span>
<span>             SEM <span class="op">=</span> <span class="va">mySEM</span>, <span class="co"># use the SEM we created above</span></span>
<span>             raw <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># make sure to tell the functions that we are using raw parameters</span></span>
<span>             method <span class="op">=</span> <span class="st">"BFGS"</span> <span class="co"># use the BFGS optimizer</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">opt</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;    2.1791276    1.8180458    1.1909397    1.1740909    1.2511328    1.4725867 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;    0.6007137    0.8649836    0.5817910    1.4336940    2.1828828    0.7229781 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;    0.3605874    1.3774602   -2.5093044   -2.1126718   -0.7633056    0.6178333 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;    2.0246995    1.6022529    1.1690474    0.8385775    1.6039528    1.2711405 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;    1.1971146   -0.8013687    1.3542390   -1.8057174    5.0543838    4.7921946 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;    3.5576898    5.4646667    4.2564429    6.5631103    4.4525330    5.1362519 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;    2.9780741    6.1962639    4.0433897</span></span></code></pre></div>
<p>Note that the parameter <code>a</code> is now back at the maximum
likelihood estimate from before. However, all parameters are still in
raw format. To get the transformed parameters, let’s take one more
step:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySEM</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-setParameters.html">.setParameters</a></span><span class="op">(</span>SEM <span class="op">=</span> <span class="va">mySEM</span>, <span class="co"># the model</span></span>
<span>                                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opt</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>, <span class="co"># names of the parameters</span></span>
<span>                                  values <span class="op">=</span> <span class="va">opt</span><span class="op">$</span><span class="va">par</span>, <span class="co"># values of the parameters</span></span>
<span>                                  raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-getParameters.html">.getParameters</a></span><span class="op">(</span><span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;   2.17912764   1.81804575   1.19093968   1.17409087   1.25113276   1.47258673 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;   0.60071368   0.86498364   0.58179103   1.43369401   2.18288278   0.72297808 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;   0.36058737   1.37746019   0.08132479   0.12091448   0.46612308   1.85490471 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;   7.57383439   4.96420359   3.21892497   2.31307420   4.97264951   3.56491599 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;   3.31055101   0.44871438   3.87381195   0.16435650   5.05438384   4.79219463 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;   3.55768979   5.46466667   4.25644288   6.56311025   4.45253304   5.13625192 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;   2.97807408   6.19626389   4.04338968</span></span></code></pre></div>
<p>Compare those to the parameter estimates from
<strong>lavaan</strong>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lavaanModel</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c            a </span></span>
<span><span class="co">#&gt;        2.180        1.818        1.191        1.175        1.251        1.191 </span></span>
<span><span class="co">#&gt;            b            c  dem60~ind60  dem65~ind60  dem65~dem60       y1~~y5 </span></span>
<span><span class="co">#&gt;        1.175        1.251        1.471        0.600        0.865        0.583 </span></span>
<span><span class="co">#&gt;       y2~~y4       y2~~y6       y3~~y7       y4~~y8       y6~~y8       x1~~x1 </span></span>
<span><span class="co">#&gt;        1.440        2.183        0.712        0.363        1.372        0.081 </span></span>
<span><span class="co">#&gt;       x2~~x2       x3~~x3       y1~~y1       y2~~y2       y3~~y3       y4~~y4 </span></span>
<span><span class="co">#&gt;        0.120        0.467        1.855        7.581        4.956        3.225 </span></span>
<span><span class="co">#&gt;       y5~~y5       y6~~y6       y7~~y7       y8~~y8 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;        2.313        4.968        3.560        3.308        0.449        3.875 </span></span>
<span><span class="co">#&gt; dem65~~dem65 </span></span>
<span><span class="co">#&gt;        0.164</span></span></code></pre></div>
<p>Finally, we can compute the standard errors:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-standardErrors.html">.standardErrors</a></span><span class="op">(</span>SEM <span class="op">=</span> <span class="va">mySEM</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ind60=~x2    ind60=~x3            a            b            c  dem60~ind60 </span></span>
<span><span class="co">#&gt;   0.13885220   0.15204331   0.14166120   0.11987057   0.12295637   0.39139696 </span></span>
<span><span class="co">#&gt;  dem65~ind60  dem65~dem60       y1~~y5       y2~~y4       y2~~y6       y3~~y7 </span></span>
<span><span class="co">#&gt;   0.23828913   0.07567860   0.36462028   0.68977248   0.73096921   0.62119518 </span></span>
<span><span class="co">#&gt;       y4~~y8       y6~~y8       x1~~x1       x2~~x2       x3~~x3       y1~~y1 </span></span>
<span><span class="co">#&gt;   0.46062833   0.57969390   0.01968652   0.06991196   0.08897395   0.45717112 </span></span>
<span><span class="co">#&gt;       y2~~y2       y3~~y3       y4~~y4       y5~~y5       y6~~y6       y7~~y7 </span></span>
<span><span class="co">#&gt;   1.34332169   0.96373267   0.74092220   0.48364102   0.89600780   0.73922565 </span></span>
<span><span class="co">#&gt;       y8~~y8 ind60~~ind60 dem60~~dem60 dem65~~dem65         x1~1         x2~1 </span></span>
<span><span class="co">#&gt;   0.71425329   0.08675480   0.88802934   0.23331748   0.08406657   0.17326967 </span></span>
<span><span class="co">#&gt;         x3~1         y1~1         y2~1         y3~1         y4~1         y5~1 </span></span>
<span><span class="co">#&gt;   0.16121433   0.29892606   0.43891242   0.39404806   0.37957637   0.30446534 </span></span>
<span><span class="co">#&gt;         y6~1         y7~1         y8~1 </span></span>
<span><span class="co">#&gt;   0.39247640   0.36442149   0.37545879</span></span></code></pre></div>
<p>Let’s compare this to <strong>lavaan</strong> again:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/parameterEstimates.html" class="external-link">parameterEstimates</a></span><span class="op">(</span><span class="va">lavaanModel</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;      lhs op   rhs label   est    se</span></span>
<span><span class="co">#&gt; 1  ind60 =~    x1       1.000 0.000</span></span>
<span><span class="co">#&gt; 2  ind60 =~    x2       2.180 0.138</span></span>
<span><span class="co">#&gt; 3  ind60 =~    x3       1.818 0.152</span></span>
<span><span class="co">#&gt; 4  dem60 =~    y1       1.000 0.000</span></span>
<span><span class="co">#&gt; 5  dem60 =~    y2     a 1.191 0.139</span></span>
<span><span class="co">#&gt; 6  dem60 =~    y3     b 1.175 0.120</span></span>
<span><span class="co">#&gt; 7  dem60 =~    y4     c 1.251 0.117</span></span>
<span><span class="co">#&gt; 8  dem65 =~    y5       1.000 0.000</span></span>
<span><span class="co">#&gt; 9  dem65 =~    y6     a 1.191 0.139</span></span>
<span><span class="co">#&gt; 10 dem65 =~    y7     b 1.175 0.120</span></span>
<span><span class="co">#&gt; 11 dem65 =~    y8     c 1.251 0.117</span></span>
<span><span class="co">#&gt; 12 dem60  ~ ind60       1.471 0.392</span></span>
<span><span class="co">#&gt; 13 dem65  ~ ind60       0.600 0.226</span></span>
<span><span class="co">#&gt; 14 dem65  ~ dem60       0.865 0.075</span></span>
<span><span class="co">#&gt; 15    y1 ~~    y5       0.583 0.356</span></span>
<span><span class="co">#&gt; 16    y2 ~~    y4       1.440 0.689</span></span>
<span><span class="co">#&gt; 17    y2 ~~    y6       2.183 0.737</span></span>
<span><span class="co">#&gt; 18    y3 ~~    y7       0.712 0.611</span></span>
<span><span class="co">#&gt; 19    y4 ~~    y8       0.363 0.444</span></span>
<span><span class="co">#&gt; 20    y6 ~~    y8       1.372 0.577</span></span>
<span><span class="co">#&gt; 21    x1 ~~    x1       0.081 0.019</span></span>
<span><span class="co">#&gt; 22    x2 ~~    x2       0.120 0.070</span></span>
<span><span class="co">#&gt; 23    x3 ~~    x3       0.467 0.090</span></span>
<span><span class="co">#&gt; 24    y1 ~~    y1       1.855 0.433</span></span>
<span><span class="co">#&gt; 25    y2 ~~    y2       7.581 1.366</span></span>
<span><span class="co">#&gt; 26    y3 ~~    y3       4.956 0.956</span></span>
<span><span class="co">#&gt; 27    y4 ~~    y4       3.225 0.723</span></span>
<span><span class="co">#&gt; 28    y5 ~~    y5       2.313 0.479</span></span>
<span><span class="co">#&gt; 29    y6 ~~    y6       4.968 0.921</span></span>
<span><span class="co">#&gt; 30    y7 ~~    y7       3.560 0.710</span></span>
<span><span class="co">#&gt; 31    y8 ~~    y8       3.308 0.704</span></span>
<span><span class="co">#&gt; 32 ind60 ~~ ind60       0.449 0.087</span></span>
<span><span class="co">#&gt; 33 dem60 ~~ dem60       3.875 0.866</span></span>
<span><span class="co">#&gt; 34 dem65 ~~ dem65       0.164 0.227</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Fox, J. (2006). Teacher’s corner: Structural equation modeling with
the sem package in R. Structural Equation Modeling: A Multidisciplinary
Journal, 13(3), 465–486. <a href="https://doi.org/10.1207/s15328007sem1303_7" class="external-link uri">https://doi.org/10.1207/s15328007sem1303_7</a>
</li>
<li>McArdle, J. J., &amp; McDonald, R. P. (1984). Some algebraic
properties of the Reticular Action Model for moment structures. British
Journal of Mathematical and Statistical Psychology, 37(2), 234–251. <a href="https://doi.org/10.1111/j.2044-8317.1984.tb00802.x" class="external-link uri">https://doi.org/10.1111/j.2044-8317.1984.tb00802.x</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jannik H. Orzek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
