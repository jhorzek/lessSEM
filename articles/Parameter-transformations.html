<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lessSEM">
<title>Parameter-transformations • lessSEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parameter-transformations">
<meta property="og:description" content="lessSEM">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lessSEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/lessSEM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Definition-Variables-and-Multi-Group-SEM.html">Definition-Variables-and-Multi-Group-SEM</a>
    <a class="dropdown-item" href="../articles/General-Purpose-Optimization.html">General-Purpose-Optimization</a>
    <a class="dropdown-item" href="../articles/Mixed-Penalties.html">Mixed Penalties</a>
    <a class="dropdown-item" href="../articles/Parameter-transformations.html">Parameter-transformations</a>
    <a class="dropdown-item" href="../articles/SCAD-and-MCP.html">SCAD-and-MCP</a>
    <a class="dropdown-item" href="../articles/The-Structural-Equation-Model.html">The-Structural-Equation-Model</a>
    <a class="dropdown-item" href="../articles/The-optimizer-interface.html">The-optimizer-interface</a>
    <a class="dropdown-item" href="../articles/log-likelihood-gradients.html">log-likelihood-gradients</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Parameter-transformations</h1>
            
      
      
      <div class="d-none name"><code>Parameter-transformations.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lessSEM</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: lavaan</span></span>
<span><span class="co">#&gt; This is lavaan 0.6-14</span></span>
<span><span class="co">#&gt; lavaan is FREE software! Please report any bugs.</span></span></code></pre></div>
<p>To allow for more flexible model estimation, <strong>lessSEM</strong>
offers parameter transformations. This is an experimental feature, so be
careful when using it. However, parameter transformations can be very
powerful and simplify implementing some specific forms of
regularization.</p>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>In longitudinal SEM, it is important to investigate if parameters
stay the same over time (e.g., measurement invariance of loadings). This
can be difficult to decide and may require setting up many different
models manually. Here, regularization techniques can be very handy. For
instance, in the seminal political democracy example, the model is
typically set up as follows (see <code><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">?lavaan::sem</a></code>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a*y2 + b*y3 + c*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a*y6 + b*y7 + c*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span></code></pre></div>
<p>Note that the loadings a, b, and c are assumed to stay the same over
time. That is, measurement invariance is assumed! Relaxing this
assumption, we could define the model as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a1*y2 + b1*y3 + c1*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a2*y6 + b2*y7 + c2*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span></code></pre></div>
<p>Here, each loading is estimated separately. This results in a more
complex model. How do we know which model to use? There are many
procedures to answer this question (e.g., using modification indexes,
setting up separate models by hand, etc.). In the following, we will
show how regularization could be used (see e.g., Belzak &amp; Bauer,
2020; Jacobucci &amp; Grimm, 2018).</p>
</div>
<div class="section level2">
<h2 id="using-regularization">Using Regularization<a class="anchor" aria-label="anchor" href="#using-regularization"></a>
</h2>
<p>First, note that measurement invariance can be rephrased as <span class="math inline">\(a_1-a_2 = 0\)</span>, <span class="math inline">\(b_1-b_2 = 0\)</span>, and <span class="math inline">\(c_1-c_2 = 0\)</span>. Thus, regularizing the
differences between these parameters may allow for testing measurement
invariance (e.g., Belzak &amp; Bauer, 2020; Liang et al., 2018; Muthen
&amp; Asparouhov, 2013). In fact, this is used in Bayesian SEM to test
approximate measurement invariance (Liang et al., 2018; Muthen &amp;
Asparouhov, 2013). Similar procedures have also been developed by Huang
(2018) for multi-group differences in parameter estimates and by Fisher
et al. (2022) in vector autoregressive models. Furthermore, Jacobucci
&amp; Grimm (2018) proposed regularizing differences in latent change
score models to test equivalence of autoproportion parameters over time
using a two-step procedure. To this end, there they implemented the
<code>diff_lasso</code> in <strong>regsem</strong> (Jacobucci et al.,
2019). Such a <code>diff_lasso</code> is not available in
<strong>lessSEM</strong>. Instead, <strong>lessSEM</strong> provides a
flexible workaround: parameter transformations. To make this work, we
have to re-define our parameters.</p>
<p>Redefine:</p>
<p><span class="math display">\[
\begin{align}
a_2 &amp;= a_1 + \Delta a_2\\
b_2 &amp;= b_1 + \Delta b_2\\
c_2 &amp;= c_1 + \Delta c_2
\end{align}
\]</span> By regularizing <span class="math inline">\(\Delta
a_2\)</span>, <span class="math inline">\(\Delta b_2\)</span>, and <span class="math inline">\(\Delta c_2\)</span> towards zero, we can enforce
measurement invariance over time.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-model">Setting up the Model<a class="anchor" aria-label="anchor" href="#setting-up-the-model"></a>
</h2>
<p>We first start with the most flexible model which we want to
test:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a1*y2 + b1*y3 + c1*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a2*y6 + b2*y7 + c2*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span>
<span></span>
<span><span class="va">lavaanFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">modelSyntax</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span></code></pre></div>
<p>Note that the model defined above estimates all parameters time-point
specific. That is, no measurement invariance is assumed.</p>
<p>Now, we want to redefine the parameters as outlined above:</p>
<p><span class="math display">\[
\begin{align}
a_2 &amp;= a_1 + \Delta a_2\\
b_2 &amp;= b_1 + \Delta b_2\\
c_2 &amp;= c_1 + \Delta c_2
\end{align}
\]</span></p>
<p>In <strong>lessSEM</strong> such redefinitions are called
transformations and can be passed to the penalty functions (e.g., to
<code>lasso</code>) using the <code>modifyModel</code> command.</p>
<p>First, we have to create a definition of our transformations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">// IMPORTANT: Our transformations always have to start with the follwing line:</span></span>
<span><span class="st">parameters: a1, a2, b1, b2, c1, c2, delta_a2, delta_b2, delta_c2</span></span>
<span><span class="st"></span></span>
<span><span class="st">// In the line above, we defined the names of the parameters which we</span></span>
<span><span class="st">// want to use in our transformations. EACH AND EVERY PARAMETER USED IN</span></span>
<span><span class="st">// THE FOLLOWING MUST BE STATED ABOVE. The line must always start with</span></span>
<span><span class="st">// the keyword 'parameters' followed by a colon. The parameters must be</span></span>
<span><span class="st">// separated by commata.</span></span>
<span><span class="st">// Comments can be added by using double backslash as shown here.</span></span>
<span><span class="st"></span></span>
<span><span class="st">// Now we can state our transformations:</span></span>
<span><span class="st"></span></span>
<span><span class="st">a2 = a1 + delta_a2; // Note: Each declaration must end with a semi-colon!</span></span>
<span><span class="st">b2 = b1 + delta_b2;</span></span>
<span><span class="st">c2 = c1 + delta_c2;</span></span>
<span><span class="st">"</span></span></code></pre></div>
<p>Next, we have to pass the <code>transformations</code> variable to
the penalty function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lassoFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lasso.html">lasso</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanFit</span>, </span>
<span>                  regularized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"delta_a2"</span>, <span class="st">"delta_b2"</span>, <span class="st">"delta_c2"</span><span class="op">)</span>,<span class="co"># we want to regularize </span></span>
<span>                  <span class="co"># the differences between the parameters</span></span>
<span>                  nLambdas <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                  <span class="co"># Our model modification must make use of the modifyModel - function:</span></span>
<span>                  modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformations</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at the parameter estimates:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lassoFit</span><span class="op">)</span><span class="op">@</span><span class="va">estimates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">100</span>,<span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a1"</span>, <span class="st">"b1"</span>, <span class="st">"c1"</span>, <span class="st">"delta_a2"</span>, <span class="st">"delta_b2"</span>, <span class="st">"delta_c2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;             a1       b1       c1    delta_a2    delta_b2 delta_c2</span></span>
<span><span class="co">#&gt;  [1,] 1.210973 1.167917 1.233987  0.00000000 0.000000000        0</span></span>
<span><span class="co">#&gt;  [2,] 1.211087 1.166369 1.234012  0.00000000 0.002697893        0</span></span>
<span><span class="co">#&gt;  [3,] 1.212569 1.150755 1.234643  0.00000000 0.030061810        0</span></span>
<span><span class="co">#&gt;  [4,] 1.214346 1.135706 1.235561  0.00000000 0.057011496        0</span></span>
<span><span class="co">#&gt;  [5,] 1.216417 1.121165 1.236776  0.00000000 0.083706587        0</span></span>
<span><span class="co">#&gt;  [6,] 1.218770 1.107057 1.238262  0.00000000 0.110189007        0</span></span>
<span><span class="co">#&gt;  [7,] 1.221411 1.093357 1.240041  0.00000000 0.136518096        0</span></span>
<span><span class="co">#&gt;  [8,] 1.226621 1.080073 1.242027 -0.00396875 0.162494972        0</span></span>
<span><span class="co">#&gt;  [9,] 1.246399 1.067703 1.244333 -0.03213194 0.186303618        0</span></span>
<span><span class="co">#&gt; [10,] 1.266518 1.055795 1.247167 -0.06025881 0.210169907        0</span></span></code></pre></div>
<p>Note that the differences between the parameters get smaller with
larger <span class="math inline">\(\lambda\)</span> values. We can also
plot the differences:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lassoFit</span><span class="op">)</span></span></code></pre></div>
<p><img src="Parameter-transformations_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>To check if measurement invariance can be assumed, we can select the
best model using information criteria:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lassoFit</span>, criterion <span class="op">=</span> <span class="st">"BIC"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--||  ind60=~x2  ind60=~x3         a1         b1         c1</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.2216  1.0000 ||--||     2.1825     1.8189     1.2110     1.1679     1.2340</span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;  ----------- ----------- ----------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;  dem60~ind60 dem65~ind60 dem65~dem60     y1~~y5     y2~~y4     y3~~y7</span></span>
<span><span class="co">#&gt;  =========== =========== =========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;       1.4534      0.5935      0.8659     0.5552     1.5948     0.7806</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;      y4~~y8     y6~~y8     x1~~x1     x2~~x2     x3~~x3     y1~~y1     y2~~y2</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      0.6537     1.5350     0.0820     0.1177     0.4675     1.7929     7.3843</span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ------------</span></span>
<span><span class="co">#&gt;      y3~~y3     y4~~y4     y5~~y5     y6~~y6     y7~~y7     y8~~y8 ind60~~ind60</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ============</span></span>
<span><span class="co">#&gt;      5.0175     3.4074     2.2857     4.8978     3.5510     3.4512       0.4480</span></span>
<span><span class="co">#&gt;                                                            </span></span>
<span><span class="co">#&gt;                                                            </span></span>
<span><span class="co">#&gt;  ------------ ------------ ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;  dem60~~dem60 dem65~~dem65   delta_a2   delta_b2   delta_c2</span></span>
<span><span class="co">#&gt;  ============ ============ ========== ========== ==========</span></span>
<span><span class="co">#&gt;        3.9408       0.2034          .          .          .</span></span></code></pre></div>
<p>Note that all differences have been zeroed – that is, a model with
full measurement invariance did fit best.</p>
<p>We can also access the transformed parameters:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lassoFit</span><span class="op">@</span><span class="va">transformations</span><span class="op">)</span></span>
<span><span class="co">#&gt;      lambda alpha       a2       b2       c2</span></span>
<span><span class="co">#&gt; 1 0.2411201     1 1.210973 1.167917 1.233987</span></span>
<span><span class="co">#&gt; 2 0.2386846     1 1.210976 1.167915 1.233991</span></span>
<span><span class="co">#&gt; 3 0.2362490     1 1.210981 1.167924 1.233993</span></span>
<span><span class="co">#&gt; 4 0.2338134     1 1.210980 1.167928 1.233995</span></span>
<span><span class="co">#&gt; 5 0.2313779     1 1.210980 1.167929 1.233994</span></span>
<span><span class="co">#&gt; 6 0.2289423     1 1.210979 1.167928 1.233993</span></span></code></pre></div>
<p>Limitation: Above, we did not take into account that the variables
may have different scales; a thorough use of the method should scale the
data first.</p>
</div>
<div class="section level2">
<h2 id="some-guidelines">Some Guidelines<a class="anchor" aria-label="anchor" href="#some-guidelines"></a>
</h2>
<p>When using transformations, please make sure to give your parameters
names which are compatible with standard naming conventions in R. The
default names of lavaan (e.g., <code>f=~y1</code> for loadings) are not
supported. That is, all parameters used in the transformations should be
given names in the lavaan syntax.</p>
<p>In the example above, we used the following syntax:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a1*y2 + b1*y3 + c1*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a2*y6 + b2*y7 + c2*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span></code></pre></div>
<p>Importantly, all parameters used in the transformation
(<code>a1, b1, c1, a2, b2, c2</code>) were labeled in the lavaan syntax.
As a counter example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + y2 + y3 + y4</span></span>
<span><span class="st">     dem65 =~ y5 + y6 + y7 + y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span></code></pre></div>
<p>The syntax above specifies the same model, but will use the
lavaan-specific naming convention for the parameters. <code>a1</code>,
for example, will be named <code>dem60=~y2</code>. These names are not
compatible with the current implementation of transformations used in
<strong>lessSEM</strong>.</p>
</div>
<div class="section level2">
<h2 id="further-examples">Further Examples<a class="anchor" aria-label="anchor" href="#further-examples"></a>
</h2>
<p>Another example where the transformations could be useful is when
detecting non-stationarity in autoregressive and cross-lagged parameters
(e.g., Liang et al., 2018). In the following, we will demonstrate this
with an autoregressive model. The model is defined as:</p>
<p><span class="math display">\[
\begin{align}
\eta_t &amp;= a_t\eta_{t-1} + \zeta_t\\
\begin{bmatrix}
y_{1,t}\\
y_{2,t}\\
y_{3,t}\\
\end{bmatrix} &amp;= \begin{bmatrix}
l_1\\
l_2\\
l_3\\
\end{bmatrix} \eta_t + \pmb\varepsilon
\end{align}
\]</span></p>
<p>It is often assumed that the autoregressive effect <span class="math inline">\(a_t\)</span> is constant over time; that is, the
same autoregressive effect is used for all time points. This is a strong
assumption and we may want to test it. One way to do so is by using the
same procedure outlined above, where we define <span class="math inline">\(a_t = a_1 + \Delta a_t\)</span> (see Jacobucci
&amp; Grimm, 2018 for a similar procedure in latent change score
models). In this case, each autoregressive effect is composed of the
first autoregressive effect (<span class="math inline">\(a_1\)</span>)
and the difference between the parameters (<span class="math inline">\(\Delta a_t\)</span>). By regularizing <span class="math inline">\(\Delta a_t\)</span>, we can enforce
stationarity.</p>
<p>A drawback of the approach outlined above is that the first
autoregressive effect is treated differently from the rest: After all,
why should <span class="math inline">\(a_1\)</span> serve as baseline
and not <span class="math inline">\(a_2\)</span> or <span class="math inline">\(a_5\)</span>? We will take a slightly different
approach, again building on the idea of Fisher et al. (2022). A similar
approach has also been proposed by Bai et al. (2020). Let’s define the
autoregressive effect as</p>
<p><span class="math display">\[a_t = a_{t-1} + \Delta a_t\]</span></p>
<p>Note that <span class="math inline">\(\Delta a_t\)</span> is no
longer the difference with respect to the initial autoregressive effect
<span class="math inline">\(a_1\)</span> but the difference with respect
to the directly preceding time point. When regularizing <span class="math inline">\(\Delta a_t\)</span>, we can now detect sudden
changes in the parameter – e.g., due to an intervention. This can also
be thought of as a regime switching model, where the underlying model
changes over time (see also Ou et al., 2019 for regime switching
models). With our regularization procedure, we want to detect if and
when the process changes.</p>
<p>We won’t go into the details of how to set up the model here, but you
can find them in the source of this file (<a href="https://github.com/jhorzek/lessSEM/tree/main/vignettes/Parameter-transformations.Rmd" class="external-link">e.g.,
in GitHub</a>). We simulated a data set with 200 individuals measured at
10 time points. The autoregressive effect <span class="math inline">\(a_t\)</span> changes at <span class="math inline">\(t=4\)</span> from <span class="math inline">\(.6\)</span> to <span class="math inline">\(.2\)</span>.</p>
<p>The data looks as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;           y1_t1       y2_t1       y3_t1      y1_t2      y2_t2      y3_t2</span></span>
<span><span class="co">#&gt; [1,]  0.2627294 -0.07745288 -0.06014729  1.1052896 -0.5125258  0.1352253</span></span>
<span><span class="co">#&gt; [2,] -0.5795123  0.27989039 -1.76295329 -1.1646535  0.0607009 -0.7770722</span></span>
<span><span class="co">#&gt; [3,]  0.5746526  0.67203557  1.30772224  0.5620735  1.3873269  1.2415508</span></span>
<span><span class="co">#&gt; [4,]  1.6376973  1.30880439  1.35159277  0.4681794  1.5370870  0.6961462</span></span>
<span><span class="co">#&gt; [5,]  0.4995286 -0.23722728  0.61244148  0.3469646  0.3052115  0.2639443</span></span>
<span><span class="co">#&gt; [6,] -0.9766373  0.94700260 -0.59421930 -0.3197840  0.8221090 -0.6808501</span></span>
<span><span class="co">#&gt;           y1_t3       y2_t3      y3_t3       y1_t4      y2_t4      y3_t4</span></span>
<span><span class="co">#&gt; [1,]  0.6775861  0.48382200  0.5163607  0.06936298  1.6842420  0.5604284</span></span>
<span><span class="co">#&gt; [2,] -0.4571539 -0.30575453  0.7552239  0.06618071 -1.5803092  0.1672394</span></span>
<span><span class="co">#&gt; [3,]  0.8255529 -0.09010965  1.5877450  0.75756487  1.3579232 -0.1379793</span></span>
<span><span class="co">#&gt; [4,]  0.1872212 -1.57377418  1.1081811 -0.50832183  1.1968847 -1.6473363</span></span>
<span><span class="co">#&gt; [5,]  1.3768225  0.02394048  1.1573912  1.30350064  0.3049751 -0.0146624</span></span>
<span><span class="co">#&gt; [6,] -0.3434095 -0.90348981 -1.1760506 -1.72146444 -1.2828716 -0.4379788</span></span>
<span><span class="co">#&gt;           y1_t5      y2_t5      y3_t5      y1_t6      y2_t6       y3_t6</span></span>
<span><span class="co">#&gt; [1,] -1.6171372 -1.5100658 -2.1212448 -0.9014921 -0.9732405 -0.89209997</span></span>
<span><span class="co">#&gt; [2,]  0.1045129  0.3483139 -0.3669688 -0.6347357 -1.1095700  0.01821975</span></span>
<span><span class="co">#&gt; [3,] -1.1968405 -0.3623344 -0.8732056 -0.8290071 -0.3555817 -0.98268524</span></span>
<span><span class="co">#&gt; [4,]  0.4423361 -1.0372594 -0.8153181 -1.6003121 -2.1169045 -0.46541710</span></span>
<span><span class="co">#&gt; [5,]  1.3351806  0.1229075  0.8274846  0.4508487  0.1328104  0.65883759</span></span>
<span><span class="co">#&gt; [6,]  1.0261730  0.1686185  0.6083559 -0.7427341  0.4514472 -1.15435404</span></span>
<span><span class="co">#&gt;           y1_t7      y2_t7      y3_t7      y1_t8       y2_t8      y3_t8</span></span>
<span><span class="co">#&gt; [1,] -1.4697023 -0.9088437 -2.1031570  0.9915954  0.26021125  1.2988304</span></span>
<span><span class="co">#&gt; [2,]  0.3845160  1.0140172  1.8585956 -1.1280623  0.62646559 -0.8323908</span></span>
<span><span class="co">#&gt; [3,] -1.8270782 -0.2335533 -1.6441484 -0.2693417  0.09757043  0.5752644</span></span>
<span><span class="co">#&gt; [4,]  1.3226249  1.7154104  1.8113749  0.3459617  0.29614603  0.2463911</span></span>
<span><span class="co">#&gt; [5,] -0.3915346 -0.5549143 -0.2476716 -1.3659303  1.14721685 -0.1968243</span></span>
<span><span class="co">#&gt; [6,]  1.7453347  1.2488910  0.6649188 -0.6131110 -0.27533871  0.1895920</span></span>
<span><span class="co">#&gt;            y1_t9      y2_t9      y3_t9      y1_t10      y2_t10     y3_t10</span></span>
<span><span class="co">#&gt; [1,]  1.27416201  1.2010039  1.1426722  0.04668192 -0.24123204 -0.4421784</span></span>
<span><span class="co">#&gt; [2,] -0.41574193 -0.6890046 -1.4714503 -0.01788118  0.02058262  0.3191417</span></span>
<span><span class="co">#&gt; [3,]  0.37098052 -0.3486185 -0.4273464 -0.87844796 -1.36443913 -1.0240934</span></span>
<span><span class="co">#&gt; [4,]  0.55566216  1.2444869  0.1788493  0.81351163 -0.39685221  3.3330365</span></span>
<span><span class="co">#&gt; [5,] -1.58477183 -1.8546910  0.7432728  0.89776939  1.05624257  0.3635211</span></span>
<span><span class="co">#&gt; [6,]  0.02486185 -0.5151950 -0.2018260  1.13097234  0.74034559  2.5292256</span></span></code></pre></div>
<p>The lavaan model is defined as follows:</p>
<pre><code><span><span class="co">#&gt; eta2 ~ a1*eta1</span></span>
<span><span class="co">#&gt; eta3 ~ a2*eta2</span></span>
<span><span class="co">#&gt; eta4 ~ a3*eta3</span></span>
<span><span class="co">#&gt; eta5 ~ a4*eta4</span></span>
<span><span class="co">#&gt; eta6 ~ a5*eta5</span></span>
<span><span class="co">#&gt; eta7 ~ a6*eta6</span></span>
<span><span class="co">#&gt; eta8 ~ a7*eta7</span></span>
<span><span class="co">#&gt; eta9 ~ a8*eta8</span></span>
<span><span class="co">#&gt; eta10 ~ a9*eta9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eta1 ~~ eta1</span></span>
<span><span class="co">#&gt; eta2 ~~ v*eta2</span></span>
<span><span class="co">#&gt; eta3 ~~ v*eta3</span></span>
<span><span class="co">#&gt; eta4 ~~ v*eta4</span></span>
<span><span class="co">#&gt; eta5 ~~ v*eta5</span></span>
<span><span class="co">#&gt; eta6 ~~ v*eta6</span></span>
<span><span class="co">#&gt; eta7 ~~ v*eta7</span></span>
<span><span class="co">#&gt; eta8 ~~ v*eta8</span></span>
<span><span class="co">#&gt; eta9 ~~ v*eta9</span></span>
<span><span class="co">#&gt; eta10 ~~ v*eta10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eta1 =~ 1*y1_t1 + l2*y2_t1 + l3*y3_t1</span></span>
<span><span class="co">#&gt; y1_t1 ~~ mvar1*y1_t1</span></span>
<span><span class="co">#&gt; y2_t1 ~~ mvar2*y2_t1</span></span>
<span><span class="co">#&gt; y3_t1 ~~ mvar3*y3_t1</span></span>
<span><span class="co">#&gt; eta2 =~ 1*y1_t2 + l2*y2_t2 + l3*y3_t2</span></span>
<span><span class="co">#&gt; y1_t2 ~~ mvar1*y1_t2</span></span>
<span><span class="co">#&gt; y2_t2 ~~ mvar2*y2_t2</span></span>
<span><span class="co">#&gt; y3_t2 ~~ mvar3*y3_t2</span></span>
<span><span class="co">#&gt; eta3 =~ 1*y1_t3 + l2*y2_t3 + l3*y3_t3</span></span>
<span><span class="co">#&gt; y1_t3 ~~ mvar1*y1_t3</span></span>
<span><span class="co">#&gt; y2_t3 ~~ mvar2*y2_t3</span></span>
<span><span class="co">#&gt; y3_t3 ~~ mvar3*y3_t3</span></span>
<span><span class="co">#&gt; eta4 =~ 1*y1_t4 + l2*y2_t4 + l3*y3_t4</span></span>
<span><span class="co">#&gt; y1_t4 ~~ mvar1*y1_t4</span></span>
<span><span class="co">#&gt; y2_t4 ~~ mvar2*y2_t4</span></span>
<span><span class="co">#&gt; y3_t4 ~~ mvar3*y3_t4</span></span>
<span><span class="co">#&gt; eta5 =~ 1*y1_t5 + l2*y2_t5 + l3*y3_t5</span></span>
<span><span class="co">#&gt; y1_t5 ~~ mvar1*y1_t5</span></span>
<span><span class="co">#&gt; y2_t5 ~~ mvar2*y2_t5</span></span>
<span><span class="co">#&gt; y3_t5 ~~ mvar3*y3_t5</span></span>
<span><span class="co">#&gt; eta6 =~ 1*y1_t6 + l2*y2_t6 + l3*y3_t6</span></span>
<span><span class="co">#&gt; y1_t6 ~~ mvar1*y1_t6</span></span>
<span><span class="co">#&gt; y2_t6 ~~ mvar2*y2_t6</span></span>
<span><span class="co">#&gt; y3_t6 ~~ mvar3*y3_t6</span></span>
<span><span class="co">#&gt; eta7 =~ 1*y1_t7 + l2*y2_t7 + l3*y3_t7</span></span>
<span><span class="co">#&gt; y1_t7 ~~ mvar1*y1_t7</span></span>
<span><span class="co">#&gt; y2_t7 ~~ mvar2*y2_t7</span></span>
<span><span class="co">#&gt; y3_t7 ~~ mvar3*y3_t7</span></span>
<span><span class="co">#&gt; eta8 =~ 1*y1_t8 + l2*y2_t8 + l3*y3_t8</span></span>
<span><span class="co">#&gt; y1_t8 ~~ mvar1*y1_t8</span></span>
<span><span class="co">#&gt; y2_t8 ~~ mvar2*y2_t8</span></span>
<span><span class="co">#&gt; y3_t8 ~~ mvar3*y3_t8</span></span>
<span><span class="co">#&gt; eta9 =~ 1*y1_t9 + l2*y2_t9 + l3*y3_t9</span></span>
<span><span class="co">#&gt; y1_t9 ~~ mvar1*y1_t9</span></span>
<span><span class="co">#&gt; y2_t9 ~~ mvar2*y2_t9</span></span>
<span><span class="co">#&gt; y3_t9 ~~ mvar3*y3_t9</span></span>
<span><span class="co">#&gt; eta10 =~ 1*y1_t10 + l2*y2_t10 + l3*y3_t10</span></span>
<span><span class="co">#&gt; y1_t10 ~~ mvar1*y1_t10</span></span>
<span><span class="co">#&gt; y2_t10 ~~ mvar2*y2_t10</span></span>
<span><span class="co">#&gt; y3_t10 ~~ mvar3*y3_t10</span></span></code></pre>
<p>We fit the model using lavaan:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lavaanFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">lavaanSyntax</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                 orthogonal.y <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 orthogonal.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 missing <span class="op">=</span> <span class="st">"ml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lavaanFit</span><span class="op">)</span></span>
<span><span class="co">#&gt;         a1         a2         a3         a4         a5         a6         a7 </span></span>
<span><span class="co">#&gt;      0.484      0.535      0.531      0.135      0.124      0.040      0.173 </span></span>
<span><span class="co">#&gt;         a8         a9 eta1~~eta1          v          v          v          v </span></span>
<span><span class="co">#&gt;      0.296      0.185      1.108      0.804      0.804      0.804      0.804 </span></span>
<span><span class="co">#&gt;          v          v          v          v          v         l2         l3 </span></span>
<span><span class="co">#&gt;      0.804      0.804      0.804      0.804      0.804      0.567      0.672 </span></span>
<span><span class="co">#&gt;      mvar1      mvar2      mvar3         l2         l3      mvar1      mvar2 </span></span>
<span><span class="co">#&gt;      0.049      0.744      0.652      0.567      0.672      0.049      0.744 </span></span>
<span><span class="co">#&gt;      mvar3         l2         l3      mvar1      mvar2      mvar3         l2 </span></span>
<span><span class="co">#&gt;      0.652      0.567      0.672      0.049      0.744      0.652      0.567 </span></span>
<span><span class="co">#&gt;         l3      mvar1      mvar2      mvar3         l2         l3      mvar1 </span></span>
<span><span class="co">#&gt;      0.672      0.049      0.744      0.652      0.567      0.672      0.049 </span></span>
<span><span class="co">#&gt;      mvar2      mvar3         l2         l3      mvar1      mvar2      mvar3 </span></span>
<span><span class="co">#&gt;      0.744      0.652      0.567      0.672      0.049      0.744      0.652 </span></span>
<span><span class="co">#&gt;         l2         l3      mvar1      mvar2      mvar3         l2         l3 </span></span>
<span><span class="co">#&gt;      0.567      0.672      0.049      0.744      0.652      0.567      0.672 </span></span>
<span><span class="co">#&gt;      mvar1      mvar2      mvar3         l2         l3      mvar1      mvar2 </span></span>
<span><span class="co">#&gt;      0.049      0.744      0.652      0.567      0.672      0.049      0.744 </span></span>
<span><span class="co">#&gt;      mvar3         l2         l3      mvar1      mvar2      mvar3    y1_t1~1 </span></span>
<span><span class="co">#&gt;      0.652      0.567      0.672      0.049      0.744      0.652     -0.155 </span></span>
<span><span class="co">#&gt;    y2_t1~1    y3_t1~1    y1_t2~1    y2_t2~1    y3_t2~1    y1_t3~1    y2_t3~1 </span></span>
<span><span class="co">#&gt;     -0.088     -0.175     -0.157     -0.049     -0.085     -0.150     -0.030 </span></span>
<span><span class="co">#&gt;    y3_t3~1    y1_t4~1    y2_t4~1    y3_t4~1    y1_t5~1    y2_t5~1    y3_t5~1 </span></span>
<span><span class="co">#&gt;     -0.157     -0.095     -0.022     -0.080      0.037     -0.023      0.058 </span></span>
<span><span class="co">#&gt;    y1_t6~1    y2_t6~1    y3_t6~1    y1_t7~1    y2_t7~1    y3_t7~1    y1_t8~1 </span></span>
<span><span class="co">#&gt;      0.050      0.065     -0.002     -0.047      0.068     -0.038     -0.022 </span></span>
<span><span class="co">#&gt;    y2_t8~1    y3_t8~1    y1_t9~1    y2_t9~1    y3_t9~1   y1_t10~1   y2_t10~1 </span></span>
<span><span class="co">#&gt;     -0.028     -0.048     -0.077     -0.058     -0.041      0.013     -0.012 </span></span>
<span><span class="co">#&gt;   y3_t10~1 </span></span>
<span><span class="co">#&gt;     -0.004</span></span></code></pre></div>
<p>Note that no constraints on autoregressive effects are implemented –
each effect (a1-a9) is estimated separately.</p>
<p>We now define transformations as follows:</p>
<pre><code><span><span class="co">#&gt; parameters: a1, a2, a3, a4, a5, a6, a7, a8, a9, delta2, delta3, delta4, delta5, delta6, delta7, delta8, delta9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; a2 = a1 + delta2;</span></span>
<span><span class="co">#&gt; a3 = a2 + delta3;</span></span>
<span><span class="co">#&gt; a4 = a3 + delta4;</span></span>
<span><span class="co">#&gt; a5 = a4 + delta5;</span></span>
<span><span class="co">#&gt; a6 = a5 + delta6;</span></span>
<span><span class="co">#&gt; a7 = a6 + delta7;</span></span>
<span><span class="co">#&gt; a8 = a7 + delta8;</span></span>
<span><span class="co">#&gt; a9 = a8 + delta9;</span></span></code></pre>
<p>Finally, we can fit our model:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lassoFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lasso.html">lasso</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanFit</span>, </span>
<span>                  regularized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"delta"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,<span class="co"># we want to regularize </span></span>
<span>                  <span class="co"># the differences between the parameters</span></span>
<span>                  nLambdas <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                  <span class="co"># glmnet is considerably faster here:</span></span>
<span>                  method <span class="op">=</span> <span class="st">"glmnet"</span>,</span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/controlGlmnet.html">controlGlmnet</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  <span class="co"># Our model modification must make use of the modifyModel - function:</span></span>
<span>                  modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformations</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Extracting the best fitting model:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lassoFit</span>, criterion <span class="op">=</span> <span class="st">"BIC"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--||         a1 eta1~~eta1          v         l2         l3</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.2790  1.0000 ||--||     0.4665     1.1055     0.8051     0.5696     0.6754</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;       mvar1      mvar2      mvar3    y1_t1~1    y2_t1~1    y3_t1~1    y1_t2~1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      0.0533     0.7428     0.6500    -0.1546    -0.0878    -0.1746    -0.1565</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;     y2_t2~1    y3_t2~1    y1_t3~1    y2_t3~1    y3_t3~1    y1_t4~1    y2_t4~1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;     -0.0492    -0.0849    -0.1499    -0.0302    -0.1572    -0.0952    -0.0224</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;     y3_t4~1    y1_t5~1    y2_t5~1    y3_t5~1    y1_t6~1    y2_t6~1    y3_t6~1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;     -0.0798     0.0374    -0.0231     0.0576     0.0502     0.0651    -0.0019</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;     y1_t7~1    y2_t7~1    y3_t7~1    y1_t8~1    y2_t8~1    y3_t8~1    y1_t9~1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;     -0.0465     0.0678    -0.0383    -0.0220    -0.0279    -0.0476    -0.0775</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;     y2_t9~1    y3_t9~1   y1_t10~1   y2_t10~1   y3_t10~1     delta2     delta3</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;     -0.0579    -0.0407     0.0132    -0.0118    -0.0042          .          .</span></span>
<span><span class="co">#&gt;                                                                   </span></span>
<span><span class="co">#&gt;                                                                   </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;      delta4     delta5     delta6     delta7     delta8     delta9</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;     -0.2807          .          .          .          .          .</span></span></code></pre></div>
<p>The true autoregressive effects are given by</p>
<pre><code><span><span class="co">#&gt; [1] 0.6 0.6 0.6 0.2 0.2 0.2 0.2 0.2 0.2</span></span></code></pre>
<p>while the estimates are</p>
<pre><code><span><span class="co">#&gt; [1] 0.4665091 0.4665091 0.4665091 0.1858552 0.1858552 0.1858552 0.1858552</span></span>
<span><span class="co">#&gt; [8] 0.1858552 0.1858552</span></span></code></pre>
<p>The result is not perfect, but <strong>lessSEM</strong> correctly
identified a change in the autoregressive parameter.</p>
</div>
<div class="section level2">
<h2 id="looking-under-the-hood">Looking under the hood<a class="anchor" aria-label="anchor" href="#looking-under-the-hood"></a>
</h2>
<p>The transformations used above are implemented using <a href="https://github.com/RcppCore/RcppArmadillo" class="external-link">RcppArmadillo</a>. This
allows for a lot more complicated transformations than those outlined
before. In general, <strong>lessSEM</strong> will take your
transformations and try to translate them to C++. Let’s assume that the
model is given by our first example:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelSyntax</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a1*y2 + b1*y3 + c1*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a2*y6 + b2*y7 + c2*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 </span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span>
<span></span>
<span><span class="va">lavaanFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">modelSyntax</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span></code></pre></div>
<p>We defined the transformations to be:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">parameters: a1, a2, b1, b2, c1, c2, delta_a2, delta_b2, delta_c2</span></span>
<span><span class="st"></span></span>
<span><span class="st">a2 = a1 + delta_a2;</span></span>
<span><span class="st">b2 = b1 + delta_b2;</span></span>
<span><span class="st">c2 = c1 + delta_c2;</span></span>
<span><span class="st">"</span></span></code></pre></div>
<p>When this transformation is passed to <strong>lessSEM</strong>,
<strong>lessSEM</strong> will first try to figure out which parameters
are already in the model and which ones are new. In our case a1, a2, b1,
b2, c1, and c2 are already known, while delta_a2, delta_b2, and delta_c2
are new. <strong>lessSEM</strong> will now add the new parameters to the
internal parameter vector. Next, <strong>lessSEM</strong> will scan the
names of the parameters which appear on the left hand side of an
equation (a2, b2, and c2) in our case. This will tell
<strong>lessSEM</strong> which of your parameters are functions of other
parameters (i.e., transformations). Knowing that a2 is a function of
other parameters will tell <strong>lessSEM</strong>, that a2 should no
longer be estimated. Instead, the parameters which make up a2 are
estimated: a1 and delta_a2.</p>
<p>To see this in action, we can create the C++ function without
compilation:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformationFunction</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-compileTransformations.html">.compileTransformations</a></span><span class="op">(</span>syntax <span class="op">=</span> <span class="va">transformations</span>, </span>
<span>                                                            parameterLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/getLavaanParameters.html">getLavaanParameters</a></span><span class="op">(</span><span class="va">lavaanFit</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                            compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>First, let’s have a look at the extended parameter vector:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformationFunction</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="co">#&gt; [1] "a1"       "a2"       "b1"       "b2"       "c1"       "c2"       "delta_a2"</span></span>
<span><span class="co">#&gt; [8] "delta_b2" "delta_c2"</span></span></code></pre></div>
<p>Note that delta_a2, delta_b2, and delta_c2 have been added. Some of
these are transformations of other parameters:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformationFunction</span><span class="op">$</span><span class="va">isTransformation</span></span>
<span><span class="co">#&gt; [1] "a2" "b2" "c2"</span></span></code></pre></div>
<p>These will not be estimated but computed based on the other model
parameters.</p>
<p>Finally, the C++ function has been returned:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">transformationFunction</span><span class="op">$</span><span class="va">armaFunction</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   // [[Rcpp::depends(RcppArmadillo)]]</span></span>
<span><span class="co">#&gt;   #include &lt;RcppArmadillo.h&gt;</span></span>
<span><span class="co">#&gt;   // [[Rcpp::export]]</span></span>
<span><span class="co">#&gt;   Rcpp::NumericVector transformationFunction(Rcpp::NumericVector&amp; parameterValues, Rcpp::List transformationList)</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;   using namespace Rcpp;</span></span>
<span><span class="co">#&gt;   using namespace arma;</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   // extract required parameters from parameterValues</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; double a1 = parameterValues["a1"];</span></span>
<span><span class="co">#&gt; double a2 = parameterValues["a2"];</span></span>
<span><span class="co">#&gt; double b1 = parameterValues["b1"];</span></span>
<span><span class="co">#&gt; double b2 = parameterValues["b2"];</span></span>
<span><span class="co">#&gt; double c1 = parameterValues["c1"];</span></span>
<span><span class="co">#&gt; double c2 = parameterValues["c2"];</span></span>
<span><span class="co">#&gt; double delta_a2 = parameterValues["delta_a2"];</span></span>
<span><span class="co">#&gt; double delta_b2 = parameterValues["delta_b2"];</span></span>
<span><span class="co">#&gt; double delta_c2 = parameterValues["delta_c2"];</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; // add user defined functions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; a2 = a1 + delta_a2;</span></span>
<span><span class="co">#&gt; b2 = b1 + delta_b2;</span></span>
<span><span class="co">#&gt; c2 = c1 + delta_c2;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; // update parameters</span></span>
<span><span class="co">#&gt; parameterValues["a1"] = a1;</span></span>
<span><span class="co">#&gt; parameterValues["a2"] = a2;</span></span>
<span><span class="co">#&gt; parameterValues["b1"] = b1;</span></span>
<span><span class="co">#&gt; parameterValues["b2"] = b2;</span></span>
<span><span class="co">#&gt; parameterValues["c1"] = c1;</span></span>
<span><span class="co">#&gt; parameterValues["c2"] = c2;</span></span>
<span><span class="co">#&gt; parameterValues["delta_a2"] = delta_a2;</span></span>
<span><span class="co">#&gt; parameterValues["delta_b2"] = delta_b2;</span></span>
<span><span class="co">#&gt; parameterValues["delta_c2"] = delta_c2;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   return(parameterValues);</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt;   // https://gallery.rcpp.org/articles/passing-cpp-function-pointers/</span></span>
<span><span class="co">#&gt; typedef Rcpp::NumericVector (*transformationFunctionPtr)(Rcpp::NumericVector&amp;, //parameters</span></span>
<span><span class="co">#&gt; Rcpp::List // transformationList</span></span>
<span><span class="co">#&gt; );</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; typedef Rcpp::XPtr&lt;transformationFunctionPtr&gt; transformationFunctionPtr_t;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; // [[Rcpp::export]]</span></span>
<span><span class="co">#&gt; transformationFunctionPtr_t getPtr() {</span></span>
<span><span class="co">#&gt;         return(transformationFunctionPtr_t(new transformationFunctionPtr(&amp;transformationFunction)));</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Most importantly, note that the first step here is to extract the
required parameters from the parameter vector (e.g.,
<code>double a1 = parameterValues["a1"];</code>). Next, all of these
parameters are directly available for use in your transformations. This
is why we can simply write <code>a2 = a1 + delta_a2;</code>.
<strong>lessSEM</strong> also added the semicolons required by C++.
Finally, the transformed parameters are returned. To pass our function
to <strong>lessSEM</strong>, we also create a pointer to our function,
but this is beyond the scope here.</p>
<p>At this point you may be wondering where all the more complicated
transformations are that we promised above. Importantly, you can use any
of the functions implemented in <strong>Rcpp</strong> or
<strong>RcppArmadillo</strong> which can be applied to variables of type
<code>double</code> within your transformations without any in-depth
knowledge of C++. For instance, <strong>RcppArmadillo</strong> comes
with an exponential-function (<code>exp</code>), a <code>pow</code> and
a <code>log</code> function. Making use of this, we can implement a
univariate continuous time SEM (e.g., Voelkle &amp; Oud, 2012). Far
superior versions of this model are implemented in <a href="https://github.com/cdriveraus/ctsem" class="external-link">ctsem</a> and <a href="https://github.com/mhunter1/dynr" class="external-link">dynr</a>) and Arnold et al. (in
submission) recently derived close form solutions for the gradients of
these models which should outperform <strong>lessSEM</strong>
considerably in terms of runtime.</p>
<p>We will use the same model from above, but remove the change in the
autoregressive effect. The code to simulate the data set can be found in
the source of this file (<a href="https://github.com/jhorzek/lessSEM/blob/main/vignettes/Parameter-transformations.Rmd" class="external-link">e.g.,
on GitHub</a>).</p>
<p>The initial model is the same as before, however the autoregressive
effect is constrained to equality over time and so are the manifest
means. We also added an initial mean for latent variable <span class="math inline">\(\eta\)</span> and changed the names of some
variables to make using <strong>ctsem</strong> with this data
easier:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">lavaanSyntax</span><span class="op">)</span></span>
<span><span class="co">#&gt; eta1 ~ a*eta0</span></span>
<span><span class="co">#&gt; eta2 ~ a*eta1</span></span>
<span><span class="co">#&gt; eta3 ~ a*eta2</span></span>
<span><span class="co">#&gt; eta4 ~ a*eta3</span></span>
<span><span class="co">#&gt; eta5 ~ a*eta4</span></span>
<span><span class="co">#&gt; eta6 ~ a*eta5</span></span>
<span><span class="co">#&gt; eta7 ~ a*eta6</span></span>
<span><span class="co">#&gt; eta8 ~ a*eta7</span></span>
<span><span class="co">#&gt; eta9 ~ a*eta8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eta0 ~~ eta0</span></span>
<span><span class="co">#&gt; eta1 ~~ v*eta1</span></span>
<span><span class="co">#&gt; eta2 ~~ v*eta2</span></span>
<span><span class="co">#&gt; eta3 ~~ v*eta3</span></span>
<span><span class="co">#&gt; eta4 ~~ v*eta4</span></span>
<span><span class="co">#&gt; eta5 ~~ v*eta5</span></span>
<span><span class="co">#&gt; eta6 ~~ v*eta6</span></span>
<span><span class="co">#&gt; eta7 ~~ v*eta7</span></span>
<span><span class="co">#&gt; eta8 ~~ v*eta8</span></span>
<span><span class="co">#&gt; eta9 ~~ v*eta9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eta0~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eta0 =~ 1*y1_T0 + l2*y2_T0 + l3*y3_T0</span></span>
<span><span class="co">#&gt; y1_T0 ~~ mvar1*y1_T0</span></span>
<span><span class="co">#&gt; y2_T0 ~~ mvar2*y2_T0</span></span>
<span><span class="co">#&gt; y3_T0 ~~ mvar3*y3_T0</span></span>
<span><span class="co">#&gt; y1_T0 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T0 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T0 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta1 =~ 1*y1_T1 + l2*y2_T1 + l3*y3_T1</span></span>
<span><span class="co">#&gt; y1_T1 ~~ mvar1*y1_T1</span></span>
<span><span class="co">#&gt; y2_T1 ~~ mvar2*y2_T1</span></span>
<span><span class="co">#&gt; y3_T1 ~~ mvar3*y3_T1</span></span>
<span><span class="co">#&gt; y1_T1 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T1 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T1 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta2 =~ 1*y1_T2 + l2*y2_T2 + l3*y3_T2</span></span>
<span><span class="co">#&gt; y1_T2 ~~ mvar1*y1_T2</span></span>
<span><span class="co">#&gt; y2_T2 ~~ mvar2*y2_T2</span></span>
<span><span class="co">#&gt; y3_T2 ~~ mvar3*y3_T2</span></span>
<span><span class="co">#&gt; y1_T2 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T2 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T2 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta3 =~ 1*y1_T3 + l2*y2_T3 + l3*y3_T3</span></span>
<span><span class="co">#&gt; y1_T3 ~~ mvar1*y1_T3</span></span>
<span><span class="co">#&gt; y2_T3 ~~ mvar2*y2_T3</span></span>
<span><span class="co">#&gt; y3_T3 ~~ mvar3*y3_T3</span></span>
<span><span class="co">#&gt; y1_T3 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T3 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T3 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta4 =~ 1*y1_T4 + l2*y2_T4 + l3*y3_T4</span></span>
<span><span class="co">#&gt; y1_T4 ~~ mvar1*y1_T4</span></span>
<span><span class="co">#&gt; y2_T4 ~~ mvar2*y2_T4</span></span>
<span><span class="co">#&gt; y3_T4 ~~ mvar3*y3_T4</span></span>
<span><span class="co">#&gt; y1_T4 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T4 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T4 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta5 =~ 1*y1_T5 + l2*y2_T5 + l3*y3_T5</span></span>
<span><span class="co">#&gt; y1_T5 ~~ mvar1*y1_T5</span></span>
<span><span class="co">#&gt; y2_T5 ~~ mvar2*y2_T5</span></span>
<span><span class="co">#&gt; y3_T5 ~~ mvar3*y3_T5</span></span>
<span><span class="co">#&gt; y1_T5 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T5 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T5 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta6 =~ 1*y1_T6 + l2*y2_T6 + l3*y3_T6</span></span>
<span><span class="co">#&gt; y1_T6 ~~ mvar1*y1_T6</span></span>
<span><span class="co">#&gt; y2_T6 ~~ mvar2*y2_T6</span></span>
<span><span class="co">#&gt; y3_T6 ~~ mvar3*y3_T6</span></span>
<span><span class="co">#&gt; y1_T6 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T6 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T6 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta7 =~ 1*y1_T7 + l2*y2_T7 + l3*y3_T7</span></span>
<span><span class="co">#&gt; y1_T7 ~~ mvar1*y1_T7</span></span>
<span><span class="co">#&gt; y2_T7 ~~ mvar2*y2_T7</span></span>
<span><span class="co">#&gt; y3_T7 ~~ mvar3*y3_T7</span></span>
<span><span class="co">#&gt; y1_T7 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T7 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T7 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta8 =~ 1*y1_T8 + l2*y2_T8 + l3*y3_T8</span></span>
<span><span class="co">#&gt; y1_T8 ~~ mvar1*y1_T8</span></span>
<span><span class="co">#&gt; y2_T8 ~~ mvar2*y2_T8</span></span>
<span><span class="co">#&gt; y3_T8 ~~ mvar3*y3_T8</span></span>
<span><span class="co">#&gt; y1_T8 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T8 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T8 ~ mMean3*1</span></span>
<span><span class="co">#&gt; eta9 =~ 1*y1_T9 + l2*y2_T9 + l3*y3_T9</span></span>
<span><span class="co">#&gt; y1_T9 ~~ mvar1*y1_T9</span></span>
<span><span class="co">#&gt; y2_T9 ~~ mvar2*y2_T9</span></span>
<span><span class="co">#&gt; y3_T9 ~~ mvar3*y3_T9</span></span>
<span><span class="co">#&gt; y1_T9 ~ mMean1*1</span></span>
<span><span class="co">#&gt; y2_T9 ~ mMean2*1</span></span>
<span><span class="co">#&gt; y3_T9 ~ mMean3*1</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lavaanFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">lavaanSyntax</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                 orthogonal.y <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 orthogonal.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 missing <span class="op">=</span> <span class="st">"ml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/getLavaanParameters.html">getLavaanParameters</a></span><span class="op">(</span><span class="va">lavaanFit</span><span class="op">)</span></span>
<span><span class="co">#&gt;            a   eta0~~eta0            v       eta0~1           l2           l3 </span></span>
<span><span class="co">#&gt;  0.592770935  0.873870399  0.387065602 -0.091482670  0.578004929  0.745298413 </span></span>
<span><span class="co">#&gt;        mvar1        mvar2        mvar3       mMean1       mMean2       mMean3 </span></span>
<span><span class="co">#&gt;  0.127999058  0.750360430  0.577566347 -0.026015718  0.005858067 -0.027032832</span></span></code></pre></div>
<p>Now, we define the transformations for the latent variables to turn
our model in a continuous time SEM:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">parameters: a, ctA, v, ctV</span></span>
<span><span class="st">// NOTE: We can define starting values for our parameters. This</span></span>
<span><span class="st">// is implemented with the 'start:' keyword:</span></span>
<span><span class="st">start: ctA = -.1, ctV = .1</span></span>
<span><span class="st"></span></span>
<span><span class="st">// We changed the starting values for the ct parameters</span></span>
<span><span class="st">// because the auto-effect ctA should be negative.</span></span>
<span><span class="st"></span></span>
<span><span class="st">a = exp(ctA);</span></span>
<span><span class="st">v = log((1.0/(2.0*ctA))*(exp(2.0*ctA)-1)*pow(ctV,2.0)); // we take</span></span>
<span><span class="st">// the log because lessSEM internally takes the exponential of</span></span>
<span><span class="st">// any variance parameter (v in our case) to avoid negative variances.</span></span>
<span><span class="st">"</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lessSEMFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bfgs.html">bfgs</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanFit</span>, </span>
<span>                   <span class="co"># Our model modification must make use of the modifyModel - function:</span></span>
<span>                   modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformations</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at the parameter estimates:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lessSEMFit</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--|| eta0~~eta0     eta0~1         l2         l3      mvar1</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.0000  0.0000 ||--||     0.8736    -0.0902     0.5780     0.7453     0.1280</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;       mvar2      mvar3     mMean1     mMean2     mMean3        ctA        ctV</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      0.7504     0.5775    -0.0267     0.0054    -0.0276    -0.5228     0.7899</span></span></code></pre></div>
<p>For comparison, we will run the same model with
<strong>ctsem</strong>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cdriveraus/ctsemOMX" class="external-link">ctsemOMX</a></span><span class="op">)</span></span>
<span><span class="va">dataCt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"dT1"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT3"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT4"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT5"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT6"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT7"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT8"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="st">"dT9"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ctsem/man/ctModel.html" class="external-link">ctModel</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"omx"</span>, </span>
<span>                  n.manifest <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                  n.latent <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  Tpoints <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  manifestNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1"</span>,<span class="st">"y2"</span>, <span class="st">"y3"</span><span class="op">)</span>, </span>
<span>                  latentNames <span class="op">=</span> <span class="st">"eta"</span>,</span>
<span>                  LAMBDA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                                    <span class="st">"l2"</span>,</span>
<span>                                    <span class="st">"l3"</span><span class="op">)</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                  DRIFT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cFit</span> <span class="op">&lt;-</span> <span class="fu">ctFit</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dataCt</span>, ctmodelobj <span class="op">=</span> <span class="va">cModel</span><span class="op">)</span></span>
<span><span class="va">ctSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cFit</span><span class="op">)</span></span></code></pre></div>
<p>The parameter <code>ctA</code> in our model corresponds to the
<code>DRIFT</code> parameter in the ctsem summary and the parameter
<code>ctV</code> corresponds to the root of the <code>DIFFUSION</code>
parameter in the ctsem summary:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lessSEMFit</span><span class="op">)</span><span class="op">@</span><span class="va">estimates</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctA"</span>, <span class="st">"ctV"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        ctA        ctV </span></span>
<span><span class="co">#&gt; -0.5228340  0.7899115</span></span>
<span></span>
<span><span class="co"># drift value from ctsem:</span></span>
<span><span class="va">ctSummary</span><span class="op">$</span><span class="va">DRIFT</span></span>
<span><span class="co">#&gt;            eta</span></span>
<span><span class="co">#&gt; eta -0.5229469</span></span>
<span><span class="co"># sqrt(diffusion) value from ctsem:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ctSummary</span><span class="op">$</span><span class="va">DIFFUSION</span><span class="op">)</span></span>
<span><span class="co">#&gt;           eta</span></span>
<span><span class="co">#&gt; eta 0.7900236</span></span></code></pre></div>
<div class="section level3">
<h3 id="making-use-of-c">Making use of C++<a class="anchor" aria-label="anchor" href="#making-use-of-c"></a>
</h3>
<p>In the example above, we used a univariate ctsem. Because of this,
all our functions were fairly simple in that we only needed the
<code>log</code>, <code>exp</code>, and <code>pow</code> functions for
single variables. However, because <strong>lessSEM</strong> creates a
C++ function, we can build much more powerful transformations if we are
familiar with <strong>RcppArmadillo</strong>. In the following, we will
therefore extend the example to a multivariate continuous time SEM. We
will use the AnomAuth data set from ctsem. The data is included in the
<strong>ctsemOMX</strong> package:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"AnomAuth"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">AnomAuth</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Y1_T0 Y2_T0 Y1_T1 Y2_T1 Y1_T2 Y2_T2 Y1_T3 Y2_T3 Y1_T4 Y2_T4 dT1 dT2 dT3 dT4</span></span>
<span><span class="co">#&gt; 1  2.67  3.50  3.33   3.5    NA    NA    NA    NA    NA    NA   1   1   2   2</span></span>
<span><span class="co">#&gt; 2  3.33  3.25    NA    NA    NA    NA    NA    NA    NA    NA   1   1   2   2</span></span>
<span><span class="co">#&gt; 3  3.33  2.75  3.33   3.0  3.33   2.5  2.33     3  2.33     3   1   1   2   2</span></span>
<span><span class="co">#&gt; 4  3.33  3.25    NA    NA    NA    NA    NA    NA    NA    NA   1   1   2   2</span></span>
<span><span class="co">#&gt; 5  4.00  4.00    NA    NA    NA    NA    NA    NA    NA    NA   1   1   2   2</span></span>
<span><span class="co">#&gt; 6  3.67  4.00    NA    NA    NA    NA  4.00     4  4.00     4   1   1   2   2</span></span></code></pre></div>
<p>The five measurement occasions are unequally spaced. In a discrete
time model, we could take care of this by implementing a model with
different autoregressive and cross-lagged effects for the different time
intervals:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initial time point</span></span>
<span><span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> </span>
<span>  <span class="st">"eta1_T0 =~ 1 * Y1_T0</span></span>
<span><span class="st">eta2_T0 =~ 1 * Y2_T0</span></span>
<span><span class="st">Y1_T0 ~~ 0*Y1_T0</span></span>
<span><span class="st">Y2_T0 ~~ 0*Y2_T0\n"</span></span>
<span></span>
<span><span class="co"># variances</span></span>
<span><span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                  <span class="st">"eta1_T0 ~~ v0_11 * eta1_T0 + v0_12 * eta2_T0\neta2_T0 ~~ v0_22 * eta2_T0\n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># means</span></span>
<span><span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                  <span class="st">"eta1_T0 ~ 1\neta2_T0 ~ 1\nY1_T0~mMean1*1\nY2_T0~mMean2*1\n"</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">tp</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">tp</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="st">"a1"</span></span>
<span>    <span class="va">v</span> <span class="op">&lt;-</span> <span class="st">"v1"</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span><span class="st">"a2"</span></span>
<span>    <span class="va">v</span> <span class="op">&lt;-</span> <span class="st">"v2"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># autoregressive and cross-lagged</span></span>
<span>  <span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                      <span class="st">"eta1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~ "</span>, <span class="va">a</span>, <span class="st">"_11 * eta1_T"</span>, <span class="va">tp</span>, <span class="st">" + "</span>, <span class="va">a</span>, <span class="st">"_12 * eta2_T"</span>, <span class="va">tp</span>,<span class="st">"\n"</span>,</span>
<span>                      <span class="st">"eta2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~ "</span>, <span class="va">a</span>, <span class="st">"_21 * eta1_T"</span>, <span class="va">tp</span>, <span class="st">" + "</span>, <span class="va">a</span>, <span class="st">"_22 * eta2_T"</span>, <span class="va">tp</span>, <span class="st">"\n"</span></span>
<span>                    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># variances</span></span>
<span>  <span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                      <span class="st">"eta1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~~ "</span>, <span class="va">v</span>, <span class="st">"_11 * eta1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" + "</span>, <span class="va">v</span>, <span class="st">"_12 * eta2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>,<span class="st">"\n"</span>,</span>
<span>                      <span class="st">"eta2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~~ "</span>, <span class="va">v</span>, <span class="st">"_22 * eta2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">"\n"</span></span>
<span>                    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loadings</span></span>
<span>  <span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                      <span class="st">"eta1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" =~ 1 * Y1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>,<span class="st">"\n"</span>,</span>
<span>                      <span class="st">"eta2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" =~ 1 * Y2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>,<span class="st">"\n"</span></span>
<span>                    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># manifest variances</span></span>
<span>  <span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                      <span class="st">"Y1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~~ 0* Y1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">"\n"</span>,</span>
<span>                      <span class="st">"Y2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~~ 0* Y2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">"\n"</span></span>
<span>                    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># manifest means</span></span>
<span>  <span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                      <span class="st">"Y1_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~ mMean1 * 1\n"</span>,</span>
<span>                      <span class="st">"Y2_T"</span>, <span class="va">tp</span><span class="op">+</span><span class="fl">1</span>, <span class="st">" ~ mMean2 * 1\n"</span></span>
<span>                    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">lavaanSyntax</span><span class="op">)</span></span>
<span><span class="co">#&gt; eta1_T0 =~ 1 * Y1_T0</span></span>
<span><span class="co">#&gt; eta2_T0 =~ 1 * Y2_T0</span></span>
<span><span class="co">#&gt; Y1_T0 ~~ 0*Y1_T0</span></span>
<span><span class="co">#&gt; Y2_T0 ~~ 0*Y2_T0</span></span>
<span><span class="co">#&gt; eta1_T0 ~~ v0_11 * eta1_T0 + v0_12 * eta2_T0</span></span>
<span><span class="co">#&gt; eta2_T0 ~~ v0_22 * eta2_T0</span></span>
<span><span class="co">#&gt; eta1_T0 ~ 1</span></span>
<span><span class="co">#&gt; eta2_T0 ~ 1</span></span>
<span><span class="co">#&gt; Y1_T0~mMean1*1</span></span>
<span><span class="co">#&gt; Y2_T0~mMean2*1</span></span>
<span><span class="co">#&gt; eta1_T1 ~ a1_11 * eta1_T0 + a1_12 * eta2_T0</span></span>
<span><span class="co">#&gt; eta2_T1 ~ a1_21 * eta1_T0 + a1_22 * eta2_T0</span></span>
<span><span class="co">#&gt; eta1_T1 ~~ v1_11 * eta1_T1 + v1_12 * eta2_T1</span></span>
<span><span class="co">#&gt; eta2_T1 ~~ v1_22 * eta2_T1</span></span>
<span><span class="co">#&gt; eta1_T1 =~ 1 * Y1_T1</span></span>
<span><span class="co">#&gt; eta2_T1 =~ 1 * Y2_T1</span></span>
<span><span class="co">#&gt; Y1_T1 ~~ 0* Y1_T1</span></span>
<span><span class="co">#&gt; Y2_T1 ~~ 0* Y2_T1</span></span>
<span><span class="co">#&gt; Y1_T1 ~ mMean1 * 1</span></span>
<span><span class="co">#&gt; Y2_T1 ~ mMean2 * 1</span></span>
<span><span class="co">#&gt; eta1_T2 ~ a1_11 * eta1_T1 + a1_12 * eta2_T1</span></span>
<span><span class="co">#&gt; eta2_T2 ~ a1_21 * eta1_T1 + a1_22 * eta2_T1</span></span>
<span><span class="co">#&gt; eta1_T2 ~~ v1_11 * eta1_T2 + v1_12 * eta2_T2</span></span>
<span><span class="co">#&gt; eta2_T2 ~~ v1_22 * eta2_T2</span></span>
<span><span class="co">#&gt; eta1_T2 =~ 1 * Y1_T2</span></span>
<span><span class="co">#&gt; eta2_T2 =~ 1 * Y2_T2</span></span>
<span><span class="co">#&gt; Y1_T2 ~~ 0* Y1_T2</span></span>
<span><span class="co">#&gt; Y2_T2 ~~ 0* Y2_T2</span></span>
<span><span class="co">#&gt; Y1_T2 ~ mMean1 * 1</span></span>
<span><span class="co">#&gt; Y2_T2 ~ mMean2 * 1</span></span>
<span><span class="co">#&gt; eta1_T3 ~ a2_11 * eta1_T2 + a2_12 * eta2_T2</span></span>
<span><span class="co">#&gt; eta2_T3 ~ a2_21 * eta1_T2 + a2_22 * eta2_T2</span></span>
<span><span class="co">#&gt; eta1_T3 ~~ v2_11 * eta1_T3 + v2_12 * eta2_T3</span></span>
<span><span class="co">#&gt; eta2_T3 ~~ v2_22 * eta2_T3</span></span>
<span><span class="co">#&gt; eta1_T3 =~ 1 * Y1_T3</span></span>
<span><span class="co">#&gt; eta2_T3 =~ 1 * Y2_T3</span></span>
<span><span class="co">#&gt; Y1_T3 ~~ 0* Y1_T3</span></span>
<span><span class="co">#&gt; Y2_T3 ~~ 0* Y2_T3</span></span>
<span><span class="co">#&gt; Y1_T3 ~ mMean1 * 1</span></span>
<span><span class="co">#&gt; Y2_T3 ~ mMean2 * 1</span></span>
<span><span class="co">#&gt; eta1_T4 ~ a2_11 * eta1_T3 + a2_12 * eta2_T3</span></span>
<span><span class="co">#&gt; eta2_T4 ~ a2_21 * eta1_T3 + a2_22 * eta2_T3</span></span>
<span><span class="co">#&gt; eta1_T4 ~~ v2_11 * eta1_T4 + v2_12 * eta2_T4</span></span>
<span><span class="co">#&gt; eta2_T4 ~~ v2_22 * eta2_T4</span></span>
<span><span class="co">#&gt; eta1_T4 =~ 1 * Y1_T4</span></span>
<span><span class="co">#&gt; eta2_T4 =~ 1 * Y2_T4</span></span>
<span><span class="co">#&gt; Y1_T4 ~~ 0* Y1_T4</span></span>
<span><span class="co">#&gt; Y2_T4 ~~ 0* Y2_T4</span></span>
<span><span class="co">#&gt; Y1_T4 ~ mMean1 * 1</span></span>
<span><span class="co">#&gt; Y2_T4 ~ mMean2 * 1</span></span></code></pre></div>
<p>Setting up the model in lavaan:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lavaanFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">lavaanSyntax</span>, data <span class="op">=</span> <span class="va">AnomAuth</span>,</span>
<span>                 orthogonal.y <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 orthogonal.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 missing <span class="op">=</span> <span class="st">"ml"</span>,</span>
<span>                 do.fit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>To transform the parameters to those of a continuous time model, we
have to define the transformations again. We will not go into the
details here. See Voelkle et al. (2012) for the underlying
transformations.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">// Define all parameters which we want to use:</span></span>
<span><span class="st">parameters: a1_11, a1_12, a1_21, a1_22, a2_11, a2_12, a2_21, a2_22, </span></span>
<span><span class="st">ctA_11, ctA_12, ctA_21, ctA_22, </span></span>
<span><span class="st">v1_11, v1_12, v1_22, v2_11, v2_12, v2_22, </span></span>
<span><span class="st">ctV_11, ctV_12, ctV_22</span></span>
<span><span class="st"></span></span>
<span><span class="st">// Define the starting values for the continuous time parameters:</span></span>
<span><span class="st">start: ctA_11 = -1, ctA_12 = 0, ctA_21 = 0, ctA_22 = -1, </span></span>
<span><span class="st">ctV_11 = .1, ctV_12 = 0, ctV_22 = .1</span></span>
<span><span class="st"></span></span>
<span><span class="st">// transformations:</span></span>
<span><span class="st">arma::mat drift(2,2);</span></span>
<span><span class="st">arma::mat ARCL1(2,2);</span></span>
<span><span class="st">arma::mat ARCL2(2,2);</span></span>
<span><span class="st">arma::mat driftHash(4,4);</span></span>
<span><span class="st">drift(0,0) = ctA_11;</span></span>
<span><span class="st">drift(1,0) = ctA_21;</span></span>
<span><span class="st">drift(0,1) = ctA_12;</span></span>
<span><span class="st">drift(1,1) = ctA_22;</span></span>
<span><span class="st">ARCL1 = expmat(drift);</span></span>
<span><span class="st">ARCL2 = expmat(drift*2.0);</span></span>
<span><span class="st"></span></span>
<span><span class="st">driftHash = kron(drift, arma::eye(2,2)) + kron(arma::eye(2,2), drift);</span></span>
<span><span class="st"></span></span>
<span><span class="st">arma::mat diffusion(2,2);</span></span>
<span><span class="st">arma::mat discreteDiff1(2,2);</span></span>
<span><span class="st">arma::mat discreteDiff2(2,2);</span></span>
<span><span class="st">diffusion(0,0) = ctV_11;</span></span>
<span><span class="st">diffusion(1,0) = ctV_12;</span></span>
<span><span class="st">diffusion(0,1) = ctV_12;</span></span>
<span><span class="st">diffusion(1,1) = ctV_22;</span></span>
<span><span class="st">discreteDiff1 = arma::reshape(arma::inv(driftHash) * </span></span>
<span><span class="st">  (expmat(driftHash) - arma::eye(arma::size(expmat(driftHash))))*</span></span>
<span><span class="st">  arma::vectorise(diffusion),2,2);</span></span>
<span><span class="st">discreteDiff2 = arma::reshape(arma::inv(driftHash) * </span></span>
<span><span class="st">  (expmat(driftHash*2.0) - arma::eye(arma::size(expmat(driftHash*2.0))))*</span></span>
<span><span class="st">  arma::vectorise(diffusion),2,2);</span></span>
<span><span class="st"></span></span>
<span><span class="st">// extract parameters</span></span>
<span><span class="st"></span></span>
<span><span class="st">a1_11 = ARCL1(0,0);</span></span>
<span><span class="st">a1_12 = ARCL1(0,1);</span></span>
<span><span class="st">a1_21 = ARCL1(1,0);</span></span>
<span><span class="st">a1_22 = ARCL1(1,1);</span></span>
<span><span class="st"></span></span>
<span><span class="st">a2_11 = ARCL2(0,0);</span></span>
<span><span class="st">a2_12 = ARCL2(0,1);</span></span>
<span><span class="st">a2_21 = ARCL2(1,0);</span></span>
<span><span class="st">a2_22 = ARCL2(1,1);</span></span>
<span><span class="st"></span></span>
<span><span class="st">v1_11 = log(discreteDiff1(0,0)); // we take the log because of the internal </span></span>
<span><span class="st">// transformation in lessSEM</span></span>
<span><span class="st">v1_12 = discreteDiff1(0,1);</span></span>
<span><span class="st">v1_22 = log(discreteDiff1(1,1)); // we take the log because of the internal </span></span>
<span><span class="st">// transformation in lessSEM</span></span>
<span><span class="st"></span></span>
<span><span class="st">v2_11 = log(discreteDiff2(0,0)); // we take the log because of the internal </span></span>
<span><span class="st">// transformation in lessSEM</span></span>
<span><span class="st">v2_12 = discreteDiff2(0,1);</span></span>
<span><span class="st">v2_22 = log(discreteDiff2(1,1)); // we take the log because of the internal </span></span>
<span><span class="st">// transformation in lessSEM</span></span>
<span><span class="st">"</span></span></code></pre></div>
<p>Most importantly, we used matrices in our transformations. This is
possible, because <strong>lessSEM</strong> uses
<strong>RcppArmadillo</strong> in the background and therefore also
provides users with all of the functions implemented therein.</p>
<p>As before, we can now fit the model with <strong>lessSEM</strong></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lessSEMFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bfgs.html">bfgs</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanFit</span>,</span>
<span>                   <span class="co"># Our model modification must make use of the modifyModel - function:</span></span>
<span>                   modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformations</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For comparison, we will also fit the model with
<strong>ctsemOMX</strong>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AnomAuthmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ctsem/man/ctModel.html" class="external-link">ctModel</a></span><span class="op">(</span>LAMBDA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>                         Tpoints <span class="op">=</span> <span class="fl">5</span>, n.latent <span class="op">=</span> <span class="fl">2</span>, n.manifest <span class="op">=</span> <span class="fl">2</span>, MANIFESTVAR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, TRAITVAR <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="va">AnomAuthfit</span> <span class="op">&lt;-</span> <span class="fu">ctFit</span><span class="op">(</span><span class="va">AnomAuth</span>, <span class="va">AnomAuthmodel</span><span class="op">)</span></span></code></pre></div>
<p>The following matrices are the drifts of the <strong>lessSEM</strong>
model and the <strong>ctsemOMX</strong> model:</p>
<p>lessSEM:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lessSEMFit</span><span class="op">)</span><span class="op">@</span><span class="va">estimates</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctA_11"</span>, <span class="st">"ctA_21"</span>, <span class="st">"ctA_12"</span>, <span class="st">"ctA_22"</span><span class="op">)</span><span class="op">]</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;             [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.44814616  0.2320881</span></span>
<span><span class="co">#&gt; [2,]  0.04260196 -0.1171318</span></span></code></pre></div>
<p>ctsemOMX:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AnomAuthfit</span><span class="op">$</span><span class="va">mxobj</span><span class="op">$</span><span class="va">DRIFT</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="co">#&gt;             [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] -0.44728184  0.2324980</span></span>
<span><span class="co">#&gt; [2,]  0.04329283 -0.1174662</span></span></code></pre></div>
<p>The diffusions are given by:</p>
<p>lessSEM:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lessSEMFit</span><span class="op">)</span><span class="op">@</span><span class="va">estimates</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ctV_11"</span>, <span class="st">"ctV_12"</span>, <span class="st">"ctV_12"</span>, <span class="st">"ctV_22"</span><span class="op">)</span><span class="op">]</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;              [,1]         [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.473528285 -0.003850882</span></span>
<span><span class="co">#&gt; [2,] -0.003850882  0.154513444</span></span></code></pre></div>
<p>ctsemOMX:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AnomAuthfit</span><span class="op">$</span><span class="va">mxobj</span><span class="op">$</span><span class="va">DIFFUSIONchol</span><span class="op">$</span><span class="va">result</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">AnomAuthfit</span><span class="op">$</span><span class="va">mxobj</span><span class="op">$</span><span class="va">DIFFUSIONchol</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt;              [,1]         [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.473241884 -0.004610149</span></span>
<span><span class="co">#&gt; [2,] -0.004610149  0.154509547</span></span></code></pre></div>
<p>Regularization could be used to enforce sparsity (Orzek &amp;
Voelkle, under review):</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lassoFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lasso.html">lasso</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanFit</span>, </span>
<span>                  regularized <span class="op">=</span> <span class="st">"ctA_21"</span>,</span>
<span>                  nLambdas <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glmnet"</span>,</span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/controlGlmnet.html">controlGlmnet</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  <span class="co"># Our model modification must make use of the modifyModel - function:</span></span>
<span>                  modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformations</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lassoFit</span><span class="op">)</span></span></code></pre></div>
<p><img src="Parameter-transformations_files/figure-html/unnamed-chunk-55-1.png" width="700"></p>
<p>Again, all these steps are easier when using dedicated packages such
as <strong>ctsem</strong> and <strong>ctsemOMX</strong> for continuous
time SEM and <strong>regCtsem</strong> (Orzek &amp; Voelkle, under
review) for regularized continuous time SEM.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-it-is-implemented">How it is implemented<a class="anchor" aria-label="anchor" href="#how-it-is-implemented"></a>
</h2>
<p>The basic idea behind the transformations is as follows: Assume that
the SEM parameters are given by <span class="math inline">\(\pmb\theta\)</span>. The 2-log-likelihood of the
model is given by <span class="math inline">\(f(\pmb\theta)\)</span>.
When using transformations, we redefine <span class="math inline">\(\pmb\theta\)</span> to be a function of other
parameters, say <span class="math inline">\(\pmb\gamma\)</span>. That
is, <span class="math inline">\(\pmb\theta =\pmb g(\pmb\gamma)\)</span>,
where <span class="math inline">\(\pmb g\)</span> is a function
returning a vector. As a result, we can re-write the fitting function as
<span class="math inline">\(f(\pmb\theta) = f(\pmb
g(\pmb\gamma))\)</span>. Instead of optimizing <span class="math inline">\(\pmb\theta\)</span>, we now optimize <span class="math inline">\(\pmb\gamma\)</span>. Within
<strong>lessSEM</strong>, the gradients of <span class="math inline">\(f(\pmb\theta)\)</span> with respect to <span class="math inline">\(\pmb\theta\)</span> are implemented in closed form
as this results in a considerably faster run time. To get the gradients
of <span class="math inline">\(f(\pmb\theta) = f(\pmb
g(\pmb\gamma))\)</span> with respect to <span class="math inline">\(\pmb\gamma\)</span>, <strong>lessSEM</strong>
makes use of the <a href="https://en.wikipedia.org/wiki/Chain_rule" class="external-link">chain rule</a>. The
gradients of the transformation <span class="math inline">\(\pmb
g(\pmb\gamma)\)</span> are approximated numerically. This is similar to
the procedure by Arnold et al. (in submission) for continuous time SEM,
where the derivative of the matrix exponential is approximated
numerically, while all other elements are derived with closed form
solutions.</p>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<ul>
<li>Arnold, M., Cancér, P. F., Estrada, E., &amp; Voelkle, M. C. (in
submission). Score-Guided Recursive Partitioning of Continuous-Time
Structural Equation Models.</li>
<li>Bai, P., Safikhani, A., &amp; Michailidis, G. (2020). Multiple
Change Points Detection in Low Rank and Sparse High Dimensional Vector
Autoregressive Models. IEEE Transactions on Signal Processing, 68,
3074–3089. <a href="https://doi.org/10.1109/TSP.2020.2993145" class="external-link uri">https://doi.org/10.1109/TSP.2020.2993145</a>
</li>
<li>Belzak, W. C. M., &amp; Bauer, D. J. (2020). Improving the
assessment of measurement invariance: Using regularization to select
anchor items and identify differential item functioning. Psychological
Methods, 25(6), 673–690. <a href="https://doi.org/10.1037/met0000253" class="external-link uri">https://doi.org/10.1037/met0000253</a>
</li>
<li>Driver, C. C., Oud, J. H. L., &amp; Voelkle, M. C. (2017).
Continuous time structural equation modelling with R package ctsem.
Journal of Statistical Software, 77(5), 1–36. <a href="https://doi.org/10.18637/jss.v077.i05" class="external-link uri">https://doi.org/10.18637/jss.v077.i05</a>
</li>
<li>Fisher, Z. F., Kim, Y., Fredrickson, B. L., &amp; Pipiras, V.
(2022). Penalized Estimation and Forecasting of Multiple Subject
Intensive Longitudinal Data. Psychometrika, 87(2), 1–29. <a href="https://doi.org/10.1007/s11336-021-09825-7" class="external-link uri">https://doi.org/10.1007/s11336-021-09825-7</a>
</li>
<li>Huang, P.-H. (2018). A penalized likelihood method for multi-group
structural equation modelling. British Journal of Mathematical and
Statistical Psychology, 71(3), 499–522. <a href="https://doi.org/10.1111/bmsp.12130" class="external-link uri">https://doi.org/10.1111/bmsp.12130</a>
</li>
<li>Jacobucci, R., &amp; Grimm, K. J. (2018). Regularized Estimation of
Multivariate Latent Change Score Models. In E. Ferrer, S. M. Boker,
&amp; K. J. Grimm (Eds.), Longitudinal Multivariate Psychology (1st ed.,
pp. 109–125). Routledge. <a href="https://doi.org/10.4324/9781315160542-6" class="external-link uri">https://doi.org/10.4324/9781315160542-6</a>
</li>
<li>Jacobucci, R., Grimm, K. J., Brandmaier, A. M., Serang, S., Kievit,
R. A., &amp; Scharf, F. (2019). regsem: Regularized structural equation
modeling. <a href="https://CRAN.R-project.org/package=regsem" class="external-link uri">https://CRAN.R-project.org/package=regsem</a>
</li>
<li>Liang, X., Yang, Y., &amp; Huang, J. (2018). Evaluation of
Structural Relationships in Autoregressive Cross-Lagged Models Under
Longitudinal Approximate Invariance:A Bayesian Analysis. Structural
Equation Modeling: A Multidisciplinary Journal, 25(4), 558–572. <a href="https://doi.org/10.1080/10705511.2017.1410706" class="external-link uri">https://doi.org/10.1080/10705511.2017.1410706</a>
</li>
<li>Muthen, B., &amp; Asparouhov, T. (2013). BSEM Measurement Invariance
Analysis. Mplus Web Notes: No. 17.</li>
<li>Ou, L., Hunter, M., D., &amp; Chow, S.-M. (2019). Whats for dynr: A
package for linear and nonlinear dynamic modeling in r. The R Journal,
11(1), 91–111. <a href="https://doi.org/10.32614/RJ-2019-012" class="external-link uri">https://doi.org/10.32614/RJ-2019-012</a>
</li>
<li>Orzek, J. H., &amp; Voelkle, M. C. (under review). Regularized
continuous time structural equation models: A network perspective.</li>
<li>Voelkle, M. C., Oud, J. H. L., Davidov, E., &amp; Schmidt, P.
(2012). An sem approach to continuous time modeling of panel data:
Relating authoritarianism and anomia. Psychological Methods, 17(2),
176–192. <a href="https://doi.org/10.1037/a0027543" class="external-link uri">https://doi.org/10.1037/a0027543</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jannik H. Orzek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
