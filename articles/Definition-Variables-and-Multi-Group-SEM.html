<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lessSEM">
<title>Definition-Variables-and-Multi-Group-SEM • lessSEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Definition-Variables-and-Multi-Group-SEM">
<meta property="og:description" content="lessSEM">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lessSEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/lessSEM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Definition-Variables-and-Multi-Group-SEM.html">Definition-Variables-and-Multi-Group-SEM</a>
    <a class="dropdown-item" href="../articles/General-Purpose-Optimization.html">General-Purpose-Optimization</a>
    <a class="dropdown-item" href="../articles/Mixed-Penalties.html">Mixed Penalties</a>
    <a class="dropdown-item" href="../articles/Parameter-transformations.html">Parameter-transformations</a>
    <a class="dropdown-item" href="../articles/SCAD-and-MCP.html">SCAD-and-MCP</a>
    <a class="dropdown-item" href="../articles/The-Structural-Equation-Model.html">The-Structural-Equation-Model</a>
    <a class="dropdown-item" href="../articles/The-optimizer-interface.html">The-optimizer-interface</a>
    <a class="dropdown-item" href="../articles/log-likelihood-gradients.html">log-likelihood-gradients</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jhorzek/lessSEM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Definition-Variables-and-Multi-Group-SEM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jhorzek/lessSEM/blob/HEAD/vignettes/Definition-Variables-and-Multi-Group-SEM.Rmd" class="external-link"><code>vignettes/Definition-Variables-and-Multi-Group-SEM.Rmd</code></a></small>
      <div class="d-none name"><code>Definition-Variables-and-Multi-Group-SEM.Rmd</code></div>
    </div>

    
    
<p>The basic SEM supported by <strong>lessSEM</strong> assumes that the
data is independently and identically distributed. That is, each subject
in the data set comes from the same population. This assumption may be
unrealistic, however. Researchers may suspect that subgroups within the
data set are more similar to one another than to other subgroups, for
example. That is, they differ in their parameter vectors.</p>
<p>If possible groupings within the data set are known beforehand,
multi-group models are a convenient way to allow for group-specific
parameters. Setting up such models with lavaan is explained <a href="https://lavaan.ugent.be/tutorial/groups.html" class="external-link">here</a>.
Unfortunately, <strong>lessSEM</strong> does not support the same syntax
at the moment. “Throwing” a multi-group SEM into
<strong>lessSEM</strong> will just result in errors. Instead,
<strong>lessSEM</strong> follows a slightly different approach: You can
pass multiple <strong>lavaan</strong> models at once which are then
combined into a multi-group model.</p>
<p>In the following, we will look at a two-group model to better
understand how multi-group models are implemented in
<strong>lessSEM</strong>.</p>
<div class="section level2">
<h2 id="first-step-setting-up-a-multi-group-model">First Step: Setting up a Multi-Group Model<a class="anchor" aria-label="anchor" href="#first-step-setting-up-a-multi-group-model"></a>
</h2>
<p>To set up a multi-group model in <strong>lessSEM</strong>, we first
have to fit separate models for each of the groups in
<strong>lavaan</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For simplicity, we will use a subset of the Holzinger Swineford data set </span></span>
<span><span class="co"># which is also used at https://lavaan.ugent.be/tutorial/groups.html</span></span>
<span><span class="co"># to demonstrate multi-group SEM</span></span>
<span></span>
<span><span class="co"># To use mutli-group SEM in lessSEM, we have to set up a separate model</span></span>
<span><span class="co"># for each of the groups: </span></span>
<span><span class="co"># - Pasteur: Children attending the Pasteur school</span></span>
<span><span class="co"># - Grant_White: Children attending the Grant-White school</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">HolzingerSwineford1939</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Pasteur ##</span></span>
<span><span class="va">Pasteur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">HolzingerSwineford1939</span>, <span class="va">school</span> <span class="op">==</span> <span class="st">"Pasteur"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_Pasteur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">' </span></span>
<span><span class="st">    visual  =~ l1_Pasteur*x1 + l2_Pasteur*x2 + l3_Pasteur*x3</span></span>
<span><span class="st">    x1 ~~ v1*x1</span></span>
<span><span class="st">    x2 ~~ v2*x2</span></span>
<span><span class="st">    x3 ~~ v3*x3</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    visual ~~ lv1*visual</span></span>
<span><span class="st">    x1 ~ m1*1</span></span>
<span><span class="st">    x2 ~ m2*1</span></span>
<span><span class="st">    x3 ~ m3*1'</span><span class="op">)</span></span>
<span><span class="va">fit_Pasteur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_Pasteur</span>, </span>
<span>                   data <span class="op">=</span> <span class="va">Pasteur</span>, </span>
<span>                   std.lv <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Grant-White</span></span>
<span><span class="va">Grant_White</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">HolzingerSwineford1939</span>, <span class="va">school</span> <span class="op">==</span> <span class="st">"Grant-White"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_Grant_White</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">' </span></span>
<span><span class="st">    visual  =~ l1_Grant_White*x1 + l2_Grant_White*x2 + l3_Grant_White*x3</span></span>
<span><span class="st">    x1 ~~ v1*x1</span></span>
<span><span class="st">    x2 ~~ v2*x2</span></span>
<span><span class="st">    x3 ~~ v3*x3</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    visual ~~ lv1*visual</span></span>
<span><span class="st">    x1 ~ m1*1</span></span>
<span><span class="st">    x2 ~ m2*1</span></span>
<span><span class="st">    x3 ~ m3*1'</span><span class="op">)</span></span>
<span><span class="va">fit_Grant_White</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_Grant_White</span>, </span>
<span>                       data <span class="op">=</span> <span class="va">Grant_White</span>, </span>
<span>                       std.lv <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="second-step-pass-the-model-to-lesssem">Second Step: Pass the Model to <strong>lessSEM</strong><a class="anchor" aria-label="anchor" href="#second-step-pass-the-model-to-lesssem"></a>
</h2>
<p>Now that we have our group-specific models, we can pass them to
<strong>lessSEM</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jhorzek/lessSEM" class="external-link">lessSEM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We will just estimate the parameters using the BFGS optimizer without any </span></span>
<span><span class="co"># regularization.</span></span>
<span><span class="co"># Note that we pass the two models as a vector. This is very important: lessSEM</span></span>
<span><span class="co"># will then set up the multi-group model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bfgs.html">bfgs</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_Pasteur</span>, <span class="va">fit_Grant_White</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at the parameters:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--|| l1_Pasteur l2_Pasteur l3_Pasteur         v1         v2</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.0000  0.0000 ||--||     0.7240     0.5610     0.8824     0.8449     1.0711</span></span>
<span><span class="co">#&gt;                                                                           </span></span>
<span><span class="co">#&gt;                                                                           </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- -------------- --------------</span></span>
<span><span class="co">#&gt;          v3         m1         m2         m3 l1_Grant_White l2_Grant_White</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ============== ==============</span></span>
<span><span class="co">#&gt;      0.6108     4.9212     6.0770     2.2281         0.7088         0.5536</span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;  --------------</span></span>
<span><span class="co">#&gt;  l3_Grant_White</span></span>
<span><span class="co">#&gt;  ==============</span></span>
<span><span class="co">#&gt;          0.7360</span></span></code></pre></div>
<p>That’s curious! There are group-specific parameters, but
<strong>only</strong> for the parameters where we provided
group-specific names! This is very important:</p>
<blockquote>
<p><strong>Important</strong>: If you set up a multi-group model with
<strong>lessSEM</strong>, <strong>lessSEM</strong> will assume that all
parameters with the same names should also have the same values. This
includes parameters which you may have estimated, but for whom the names
were provided by <strong>lavaan</strong> (e.g., variances).</p>
</blockquote>
<div class="section level3">
<h3 id="different-models-with-shared-parameter-labels">Different Models with Shared Parameter Labels<a class="anchor" aria-label="anchor" href="#different-models-with-shared-parameter-labels"></a>
</h3>
<p>All parameters that have the same labels in multiple models will be
constrained to equality across models! If you are not careful, this can
result in very annoying mistakes. To demonstrate this, we will use two
very different models which may share some parameter names.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model from ?lavaan::sem</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">' </span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + a*y2 + b*y3 + c*y4</span></span>
<span><span class="st">     dem65 =~ y5 + a*y6 + b*y7 + c*y8</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">    dem65 ~ ind60 + dem60</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # residual correlations</span></span>
<span><span class="st">    y1 ~~ y5</span></span>
<span><span class="st">    y2 ~~ y4 + y6</span></span>
<span><span class="st">    y3 ~~ y7</span></span>
<span><span class="st">    y4 ~~ y8</span></span>
<span><span class="st">    y6 ~~ y8</span></span>
<span><span class="st">'</span></span>
<span></span>
<span><span class="va">fitPolDem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">PoliticalDemocracy</span>,</span>
<span>                 meanstructure <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model from ?lavaan::cfa</span></span>
<span><span class="va">HS.model</span> <span class="op">&lt;-</span> <span class="st">' visual  =~ x1 + x2 + x3</span></span>
<span><span class="st">              textual =~ x4 + x5 + x6</span></span>
<span><span class="st">              speed   =~ x7 + x8 + x9 '</span></span>
<span></span>
<span><span class="va">fitHS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="va">HS.model</span>,</span>
<span>             data <span class="op">=</span> <span class="va">HolzingerSwineford1939</span>,</span>
<span>             meanstructure <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## lessSEM does not care if the models passed to the function are similar </span></span>
<span><span class="co"># or even use different data sets. Of course, it probably does not make much sense</span></span>
<span><span class="co"># to estimate two different models at the same time, but lessSEM won't stop you</span></span>
<span><span class="co"># from trying...</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bfgs.html">bfgs</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fitPolDem</span>, <span class="va">fitHS</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s first compare the fit of the separate models to that of the
multi-group model. If <strong>lessSEM</strong> were to estimate the
models truly separately we would expect the fit to be the same:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit for separate models</span></span>
<span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitPolDem</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitHS</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' 10573.13 (df=39)</span></span>
<span></span>
<span><span class="co"># fit for multi-group model:</span></span>
<span><span class="va">fit</span><span class="op">@</span><span class="va">fits</span><span class="op">$</span><span class="va">m2LL</span></span>
<span><span class="co">#&gt; [1] 10813.96</span></span></code></pre></div>
<p>Obviously, these two fits are not the same. What may have happened?
Looking at the parameter estimates of the multi-group model shows that
the two models, <code>fitPolDem</code> and <code>fitHS</code> did share
some parameter labels! For instance, the intercepts of <code>x1</code>
is called <code>x1~1</code> in both models. Therefore,
<strong>lessSEM</strong> assumed that we wanted these parameters to have
exactly the same value in both models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--||  ind60=~x2  ind60=~x3          a          b          c</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.0000  0.0000 ||--||     1.8164     1.5582     1.1879     1.1706     1.2511</span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;  ----------- ----------- ----------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;  dem60~ind60 dem65~ind60 dem65~dem60     y1~~y5     y2~~y4     y2~~y6</span></span>
<span><span class="co">#&gt;  =========== =========== =========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;       1.4062      0.4696      0.8755     0.5389     1.4270     2.2120</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;      y3~~y7     y4~~y8     y6~~y8     x1~~x1     x2~~x2     x3~~x3     y1~~y1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      0.7425     0.3718     1.3734     0.0000     1.3895     1.2086     1.8544</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;      y2~~y2     y3~~y3     y4~~y4     y5~~y5     y6~~y6     y7~~y7     y8~~y8</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      7.5981     4.9592     3.2006     2.2664     4.9911     3.6046     3.3135</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt;  ------------ ------------ ------------ ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;  ind60~~ind60 dem60~~dem60 dem65~~dem65       x1~1       x2~1       x3~1</span></span>
<span><span class="co">#&gt;  ============ ============ ============ ========== ========== ==========</span></span>
<span><span class="co">#&gt;        0.5305       3.8021       0.2003     5.0409     5.8482     2.5445</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;        y1~1       y2~1       y3~1       y4~1       y5~1       y6~1       y7~1</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      5.4463     4.2330     6.5420     4.4295     5.1139     2.9502     6.1703</span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ----------- ----------- ---------- ----------</span></span>
<span><span class="co">#&gt;        y8~1 visual=~x2 visual=~x3 textual=~x5 textual=~x6  speed=~x8  speed=~x9</span></span>
<span><span class="co">#&gt;  ========== ========== ========== =========== =========== ========== ==========</span></span>
<span><span class="co">#&gt;      4.0150     0.2791     0.4461      1.1126      0.9221     1.1746     1.0056</span></span>
<span><span class="co">#&gt;                                                                   </span></span>
<span><span class="co">#&gt;                                                                   </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;      x4~~x4     x5~~x5     x6~~x6     x7~~x7     x8~~x8     x9~~x9</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;      0.3681     0.4434     0.3610     0.7750     0.4590     0.6025</span></span>
<span><span class="co">#&gt;                                                                            </span></span>
<span><span class="co">#&gt;                                                                            </span></span>
<span><span class="co">#&gt;  -------------- ---------------- ------------ --------------- -------------</span></span>
<span><span class="co">#&gt;  visual~~visual textual~~textual speed~~speed visual~~textual visual~~speed</span></span>
<span><span class="co">#&gt;  ============== ================ ============ =============== =============</span></span>
<span><span class="co">#&gt;          1.3695           0.9839       0.4084          0.4666        0.2615</span></span>
<span><span class="co">#&gt;                                                                       </span></span>
<span><span class="co">#&gt;                                                                       </span></span>
<span><span class="co">#&gt;  -------------- ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;  textual~~speed       x4~1       x5~1       x6~1       x7~1       x8~1</span></span>
<span><span class="co">#&gt;  ============== ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;          0.1746     3.0967     4.3804     2.2186     4.2060     5.5507</span></span>
<span><span class="co">#&gt;            </span></span>
<span><span class="co">#&gt;            </span></span>
<span><span class="co">#&gt;  ----------</span></span>
<span><span class="co">#&gt;        x9~1</span></span>
<span><span class="co">#&gt;  ==========</span></span>
<span><span class="co">#&gt;      5.3943</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="regularized-multi-group-models">Regularized Multi-Group Models<a class="anchor" aria-label="anchor" href="#regularized-multi-group-models"></a>
</h2>
<p>All multi-group models can be regularized similar to the standard
SEM: Instead of using the <code>bfgs</code>-function, we use (for
instance), the <code>lasso</code>-function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lasso.html">lasso</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_Pasteur</span>, <span class="va">fit_Grant_White</span><span class="op">)</span>,</span>
<span>             regularized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l1_Pasteur"</span><span class="op">)</span>, </span>
<span>             nLambdas <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>The coefficients can be extracted as usual:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--|| l1_Pasteur l2_Pasteur l3_Pasteur         v1         v2</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.0000  1.0000 ||--||     0.7241     0.5611     0.8822     0.8447     1.0710</span></span>
<span><span class="co">#&gt;                                                                           </span></span>
<span><span class="co">#&gt;                                                                           </span></span>
<span><span class="co">#&gt;  ---------- ---------- ---------- ---------- -------------- --------------</span></span>
<span><span class="co">#&gt;          v3         m1         m2         m3 l1_Grant_White l2_Grant_White</span></span>
<span><span class="co">#&gt;  ========== ========== ========== ========== ============== ==============</span></span>
<span><span class="co">#&gt;      0.6110     4.9211     6.0768     2.2279         0.7089         0.5537</span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt;  --------------</span></span>
<span><span class="co">#&gt;  l3_Grant_White</span></span>
<span><span class="co">#&gt;  ==============</span></span>
<span><span class="co">#&gt;          0.7358</span></span></code></pre></div>
<div class="section level3">
<h3 id="regularizing-differences-between-parameters-using-lesssem">Regularizing Differences Between Parameters using
<strong>lessSEM</strong><a class="anchor" aria-label="anchor" href="#regularizing-differences-between-parameters-using-lesssem"></a>
</h3>
<p>Where regularized multi-group models shine is when automatically
testing for group-differences. This was proposed by Huang (2018) and
provides a convenient way to decide which of the parameters should be
group-specific. To this end, differences between parameters must be
regularized. Say, we are interested in the loading <code>l1</code> and
wonder if we do indeed need separate loadings for students attending the
Pasteur school (<code>l1_Pasteur</code>) and the Grant-White school
(<code>l1_Grant_White</code>). Using the Pasteur school as baseline
group (see Huang, 2018, for more details), we can define
<code>l1_Grant_White = l1_Pasteur + l1_delta</code>, where
<code>l1_delta</code> is the difference between the two schools. If
<code>l1_delta</code> is zero, then both schools have the same loading
(i.e., we have measurement invariance). Within <strong>lessSEM</strong>,
we can regularize such differences using transformations (see
<code><a href="../articles/Parameter-transformations.html">vignette(topic = "Parameter-transformations", package = "lessSEM")</a></code>
for more details). Therefore, the first step is to define the
transformation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformation</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">parameters: l1_Pasteur, l1_Grant_White, l1_delta</span></span>
<span><span class="st">l1_Grant_White = l1_Pasteur + l1_delta;</span></span>
<span><span class="st">"</span></span></code></pre></div>
<p>Next, we pass this transformation to our model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lasso.html">lasso</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_Pasteur</span>, <span class="va">fit_Grant_White</span><span class="op">)</span>,</span>
<span>             regularized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l1_delta"</span><span class="op">)</span>, <span class="co"># we want to regularize the difference!</span></span>
<span>             nLambdas <span class="op">=</span> <span class="fl">20</span>,</span>
<span>             modifyModel <span class="op">=</span> <span class="fu"><a href="../reference/modifyModel.html">modifyModel</a></span><span class="op">(</span>transformations <span class="op">=</span> <span class="va">transformation</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s look at the parameter estimates:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span><span class="op">@</span><span class="va">estimates</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l1_Pasteur"</span>, <span class="st">"l1_delta"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; l1_Pasteur   l1_delta </span></span>
<span><span class="co">#&gt;   0.716718   0.000000</span></span></code></pre></div>
<p>As the <code>l1_delta</code> parameter has been set to zero, we can
assume measurement invariance. Note that you won’t find
<code>l1_Grant_White</code> in the parameters of the model. This is
because <code>l1_Grant_White</code> is a deterministic function of the
actual parameters <code>l1_Pasteur</code> and <code>l1_delta</code>. If
you want to find the value for <code>l1_Grant_White</code>, have a look
at:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">@</span><span class="va">transformations</span></span>
<span><span class="co">#&gt;          lambda alpha l1_Grant_White</span></span>
<span><span class="co">#&gt; 1  0.0056517504     1      0.7167576</span></span>
<span><span class="co">#&gt; 2  0.0053542898     1      0.7167180</span></span>
<span><span class="co">#&gt; 3  0.0050568293     1      0.7166009</span></span>
<span><span class="co">#&gt; 4  0.0047593687     1      0.7161368</span></span>
<span><span class="co">#&gt; 5  0.0044619082     1      0.7155761</span></span>
<span><span class="co">#&gt; 6  0.0041644476     1      0.7151688</span></span>
<span><span class="co">#&gt; 7  0.0038669871     1      0.7147807</span></span>
<span><span class="co">#&gt; 8  0.0035695265     1      0.7141878</span></span>
<span><span class="co">#&gt; 9  0.0032720660     1      0.7137695</span></span>
<span><span class="co">#&gt; 10 0.0029746054     1      0.7132645</span></span>
<span><span class="co">#&gt; 11 0.0026771449     1      0.7128818</span></span>
<span><span class="co">#&gt; 12 0.0023796844     1      0.7125411</span></span>
<span><span class="co">#&gt; 13 0.0020822238     1      0.7120493</span></span>
<span><span class="co">#&gt; 14 0.0017847633     1      0.7115889</span></span>
<span><span class="co">#&gt; 15 0.0014873027     1      0.7110626</span></span>
<span><span class="co">#&gt; 16 0.0011898422     1      0.7107554</span></span>
<span><span class="co">#&gt; 17 0.0008923816     1      0.7102373</span></span>
<span><span class="co">#&gt; 18 0.0005949211     1      0.7097089</span></span>
<span><span class="co">#&gt; 19 0.0002974605     1      0.7094042</span></span>
<span><span class="co">#&gt; 20 0.0000000000     1      0.7088852</span></span></code></pre></div>
<p>Note that <strong>lslx</strong> (Huang, 2020) supports different
penalties for the delta parameter (<code>l1_delta</code>) and the
baseline parameter (<code>l1_Pasteur</code>). This is currently not
supported by <strong>lessSEM</strong>.</p>
</div>
</div>
<div class="section level2">
<h2 id="cross-validation">Cross-Validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h2>
<p>Automatic cross-validation for multi-group models with, for instance,
<code>cvLasso</code> is <em>not</em> yet implemented. This is because it
can be difficult to decide how to split up the data set in each
submodel. If you want to use cross-validation, you will unfortunately
have to set up the procedure manually.</p>
</div>
<div class="section level2">
<h2 id="definition-variables">Definition Variables<a class="anchor" aria-label="anchor" href="#definition-variables"></a>
</h2>
<p>Models with definition variables are basically the same as
multi-group models, with the sole exception that the group-specific
parameters are not estimated but fixed to specific values.</p>
<blockquote>
<p>If your main interest is in setting up a multi-group SEM with
<strong>lessSEM</strong> and you don’t care about the details, the
<strong>lessTemplates</strong> package (<a href="https://github.com/jhorzek/lessTemplates" class="external-link uri">https://github.com/jhorzek/lessTemplates</a>) provides means
to easily set up such models (see SEMWithDefinitionVariables function in
<strong>lessTemplates</strong>).</p>
</blockquote>
<p>In the following, we will look in detail at how definition variables
can be used in <strong>lessSEM</strong></p>
<div class="section level3">
<h3 id="the-details">The details …<a class="anchor" aria-label="anchor" href="#the-details"></a>
</h3>
<p>Unfortunately, <strong>lavaan</strong> does not allow us to set up
models for <span class="math inline">\(N=1\)</span>, however. This is
required for many definition variable applications, such as latent
growth curve models with subject-specific measurement occasions. In the
following, we will use a workaround.</p>
<p>Let’s first simulate some data:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Population parameters ####</span></span>
<span><span class="va">intercept_mu</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">intercept_sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">slope_mu</span> <span class="op">&lt;-</span> <span class="fl">.3</span></span>
<span><span class="va">slope_sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#### data set ####</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">intercepts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, </span>
<span>                    mean <span class="op">=</span> <span class="va">intercept_mu</span>, </span>
<span>                    sd <span class="op">=</span> <span class="va">intercept_sigma</span><span class="op">)</span></span>
<span><span class="va">slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, </span>
<span>                mean <span class="op">=</span> <span class="va">slope_mu</span>, </span>
<span>                sd <span class="op">=</span> <span class="va">slope_sigma</span><span class="op">)</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                nrow <span class="op">=</span> <span class="va">N</span>,</span>
<span>                ncol <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span><span class="op">*</span><span class="fl">5</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">.2</span>,max <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                 nrow <span class="op">=</span> <span class="va">N</span>,</span>
<span>                 ncol <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                 byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># we add some jitter to make the times person-specific</span></span>
<span></span>
<span><span class="va">lgcData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">N</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lgcData</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">intercepts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">*</span> <span class="va">slopes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">lgcData</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fl">.3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">lgcData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">lgcData</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lgcData</span><span class="op">)</span></span>
<span><span class="co">#&gt;            x0         x1         x2        x3        x4        x5</span></span>
<span><span class="co">#&gt; 1  0.26801876 -0.5353028 -1.0262295 -2.533564 -2.890246 -4.655061</span></span>
<span><span class="co">#&gt; 2  0.26260181 -0.4802635 -2.0790754 -2.686983 -3.677022 -4.540501</span></span>
<span><span class="co">#&gt; 3 -0.71054447 -0.5477048 -0.5747618 -1.231821 -1.229388 -1.418401</span></span>
<span><span class="co">#&gt; 4  0.14564354  1.0690979  1.8919916  2.842025  2.953471  4.654879</span></span>
<span><span class="co">#&gt; 5  0.09501816  1.6350899  2.6331440  4.729328  5.423381  6.799296</span></span>
<span><span class="co">#&gt; 6  2.51013193  3.0917904  4.1193617  5.749542  6.222599  7.716919</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span><span class="co">#&gt; [1,]    0 0.94 2.13 3.01 3.91 5.12</span></span>
<span><span class="co">#&gt; [2,]    0 0.84 2.13 2.91 4.10 5.19</span></span>
<span><span class="co">#&gt; [3,]    0 0.83 2.14 3.12 3.95 4.93</span></span>
<span><span class="co">#&gt; [4,]    0 0.88 2.03 3.16 4.01 5.03</span></span>
<span><span class="co">#&gt; [5,]    0 1.07 2.01 3.00 3.81 4.82</span></span>
<span><span class="co">#&gt; [6,]    0 1.17 2.11 2.88 4.06 5.06</span></span></code></pre></div>
<p>Note that the times are random and subject-specific. We need a
separate model for each subject. Because lavaan won’t let us set up such
models, we will instead set up models using the entire data set and
replace the data post-hoc.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">model_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">int =~ 1*x0 + 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5</span></span>
<span><span class="st">slope =~ "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span>,<span class="st">"*x0 + </span></span>
<span><span class="st">         "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span>,<span class="st">"*x1 + </span></span>
<span><span class="st">         "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span>,<span class="st">"*x2 +  </span></span>
<span><span class="st">         "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span>,<span class="st">"*x3 + </span></span>
<span><span class="st">         "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">5</span><span class="op">]</span>,<span class="st">"*x4 + </span></span>
<span><span class="st">         "</span>,<span class="va">times</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span>,<span class="st">"*x5</span></span>
<span><span class="st">         </span></span>
<span><span class="st">         int ~ intMean*1</span></span>
<span><span class="st">         slope ~ slopeMean*1</span></span>
<span><span class="st">         </span></span>
<span><span class="st">         int ~~ intVar*int + 0*slope</span></span>
<span><span class="st">         slope ~~ slopeVar*slope</span></span>
<span><span class="st"></span></span>
<span><span class="st">x0 ~~ v*x0</span></span>
<span><span class="st">x1 ~~ v*x1</span></span>
<span><span class="st">x2 ~~ v*x2</span></span>
<span><span class="st">x3 ~~ v*x3</span></span>
<span><span class="st">x4 ~~ v*x4</span></span>
<span><span class="st">x5 ~~ v*x5</span></span>
<span><span class="st"></span></span>
<span><span class="st">x0 ~ 0*1</span></span>
<span><span class="st">x1 ~ 0*1</span></span>
<span><span class="st">x2 ~ 0*1</span></span>
<span><span class="st">x3 ~ 0*1</span></span>
<span><span class="st">x4 ~ 0*1</span></span>
<span><span class="st">x5 ~ 0*1</span></span>
<span><span class="st">"</span>  </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_i</span>, </span>
<span>             data <span class="op">=</span> <span class="va">lgcData</span>, </span>
<span>             do.fit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">internalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/lavInspect.html" class="external-link">lavInspect</a></span><span class="op">(</span><span class="va">fit_i</span>, <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co"># replace the data set</span></span>
<span><span class="va">fit_i</span><span class="op">@</span><span class="va">Data</span><span class="op">@</span><span class="va">X</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">lgcData</span><span class="op">[</span><span class="va">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">internalData</span><span class="op">)</span>,drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">models</span>, </span>
<span>            <span class="va">fit_i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Exemplarily, it makes sense to look at one of the models:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">model_i</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; int =~ 1*x0 + 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5</span></span>
<span><span class="co">#&gt; slope =~ 0*x0 + </span></span>
<span><span class="co">#&gt;          1.13*x1 + </span></span>
<span><span class="co">#&gt;          1.81*x2 +  </span></span>
<span><span class="co">#&gt;          3.06*x3 + </span></span>
<span><span class="co">#&gt;          4.12*x4 + </span></span>
<span><span class="co">#&gt;          4.98*x5</span></span>
<span><span class="co">#&gt;          </span></span>
<span><span class="co">#&gt;          int ~ intMean*1</span></span>
<span><span class="co">#&gt;          slope ~ slopeMean*1</span></span>
<span><span class="co">#&gt;          </span></span>
<span><span class="co">#&gt;          int ~~ intVar*int + 0*slope</span></span>
<span><span class="co">#&gt;          slope ~~ slopeVar*slope</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; x0 ~~ v*x0</span></span>
<span><span class="co">#&gt; x1 ~~ v*x1</span></span>
<span><span class="co">#&gt; x2 ~~ v*x2</span></span>
<span><span class="co">#&gt; x3 ~~ v*x3</span></span>
<span><span class="co">#&gt; x4 ~~ v*x4</span></span>
<span><span class="co">#&gt; x5 ~~ v*x5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; x0 ~ 0*1</span></span>
<span><span class="co">#&gt; x1 ~ 0*1</span></span>
<span><span class="co">#&gt; x2 ~ 0*1</span></span>
<span><span class="co">#&gt; x3 ~ 0*1</span></span>
<span><span class="co">#&gt; x4 ~ 0*1</span></span>
<span><span class="co">#&gt; x5 ~ 0*1</span></span></code></pre></div>
<p>Note that the loadings of the slope are fixed to the time points at
which person <code>i</code> provided data.</p>
<p>Now we can pass the models to <strong>lessSEM</strong>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bfgs.html">bfgs</a></span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span></code></pre></div>
<p>The parameters are given by:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   Tuning         ||--||  Estimates                                            </span></span>
<span><span class="co">#&gt;  ------- ------- ||--|| ---------- ---------- ---------- ---------- ----------</span></span>
<span><span class="co">#&gt;   lambda   alpha ||--||    intMean  slopeMean     intVar   slopeVar          v</span></span>
<span><span class="co">#&gt;  ======= ======= ||--|| ========== ========== ========== ========== ==========</span></span>
<span><span class="co">#&gt;   0.0000  0.0000 ||--||    -0.0152     0.2921     0.7703     0.9411     0.0851</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<ul>
<li>Huang, P.-H. (2018). A penalized likelihood method for multi-group
structural equation modelling. British Journal of Mathematical and
Statistical Psychology, 71(3), 499–522. <a href="https://doi.org/10.1111/bmsp.12130" class="external-link uri">https://doi.org/10.1111/bmsp.12130</a>
</li>
<li>Huang, P.-H. (2020). lslx: Semi-confirmatory structural equation
modeling via penalized likelihood. Journal of Statistical Software,
93(7). <a href="https://doi.org/10.18637/jss.v093.i07" class="external-link uri">https://doi.org/10.18637/jss.v093.i07</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jannik H. Orzek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
