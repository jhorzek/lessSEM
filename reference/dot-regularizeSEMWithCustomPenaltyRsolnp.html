<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Optimize a SEM with custom penalty function using the Rsolnp optimizer (see ?Rsolnp::solnp). This optimizer is the default in regsem (see ?regsem::cv_regsem)."><title>.regularizeSEMWithCustomPenaltyRsolnp — .regularizeSEMWithCustomPenaltyRsolnp • lessSEM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content=".regularizeSEMWithCustomPenaltyRsolnp — .regularizeSEMWithCustomPenaltyRsolnp"><meta property="og:description" content="Optimize a SEM with custom penalty function using the Rsolnp optimizer (see ?Rsolnp::solnp). This optimizer is the default in regsem (see ?regsem::cv_regsem)."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lessSEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/lessSEM.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Definition-Variables-and-Multi-Group-SEM.html">Definition-Variables-and-Multi-Group-SEM</a>
    <a class="dropdown-item" href="../articles/General-Purpose-Optimization.html">General-Purpose-Optimization</a>
    <a class="dropdown-item" href="../articles/Mixed-Penalties.html">Mixed Penalties</a>
    <a class="dropdown-item" href="../articles/Parameter-transformations.html">Parameter-transformations</a>
    <a class="dropdown-item" href="../articles/SCAD-and-MCP.html">SCAD-and-MCP</a>
    <a class="dropdown-item" href="../articles/The-Structural-Equation-Model.html">The-Structural-Equation-Model</a>
    <a class="dropdown-item" href="../articles/The-optimizer-interface.html">The-optimizer-interface</a>
    <a class="dropdown-item" href="../articles/log-likelihood-gradients.html">log-likelihood-gradients</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>.regularizeSEMWithCustomPenaltyRsolnp</h1>
      
      <div class="d-none name"><code>dot-regularizeSEMWithCustomPenaltyRsolnp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Optimize a SEM with custom penalty function using the Rsolnp optimizer (see ?Rsolnp::solnp). This optimizer is the default in regsem (see ?regsem::cv_regsem).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">.regularizeSEMWithCustomPenaltyRsolnp</span><span class="op">(</span></span>
<span>  <span class="va">lavaanModel</span>,</span>
<span>  <span class="va">individualPenaltyFunction</span>,</span>
<span>  <span class="va">tuningParameters</span>,</span>
<span>  <span class="va">penaltyFunctionArguments</span>,</span>
<span>  startingValues <span class="op">=</span> <span class="st">"est"</span>,</span>
<span>  carryOverParameters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>lavaanModel</dt>
<dd><p>model of class lavaan</p></dd>


<dt>individualPenaltyFunction</dt>
<dd><p>penalty function which takes the current parameter values as first argument, the tuning parameters as second, and the penaltyFunctionArguments as third argument and
returns a single value - the value of the penalty function for a single person. If the true penalty function is non-differentiable (e.g., lasso) a smooth
approximation of this function should be provided.</p></dd>


<dt>tuningParameters</dt>
<dd><p>data.frame with tuning parameter values. Important: The function will iterate over the rows of these tuning parameters and pass them to your penalty function</p></dd>


<dt>penaltyFunctionArguments</dt>
<dd><p>arguments passed to individualPenaltyFunction, individualPenaltyFunctionGradient, and individualPenaltyFunctionHessian</p></dd>


<dt>startingValues</dt>
<dd><p>option to provide initial starting values. Only used for the first lambda. Three options are supported. Setting to "est" will use the estimates
from the lavaan model object. Setting to "start" will use the starting values of the lavaan model. Finally, a labeled vector with parameter
values can be passed to the function which will then be used as starting values.</p></dd>


<dt>carryOverParameters</dt>
<dd><p>should parameters from the previous iteration be used as starting values of
the next iteration?</p></dd>


<dt>control</dt>
<dd><p>option to set parameters of the optimizer; see ?Rsolnp::solnp</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Model of class regularizedSEMWithCustomPenalty</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lessSEM</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identical to regsem, lessSEM builds on the lavaan</span></span>
<span><span class="co"># package for model specification. The first step</span></span>
<span><span class="co"># therefore is to implement the model in lavaan.</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulateExampleData.html">simulateExampleData</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lavaanSyntax</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">f =~ l1*y1 + l2*y2 + l3*y3 + l4*y4 + l5*y5 +</span></span>
<span><span class="st">     l6*y6 + l7*y7 + l8*y8 + l9*y9 + l10*y10 +</span></span>
<span><span class="st">     l11*y11 + l12*y12 + l13*y13 + l14*y14 + l15*y15</span></span>
<span><span class="st">f ~~ 1*f</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="va">lavaanModel</span> <span class="op">&lt;-</span> <span class="fu">lavaan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">lavaanSyntax</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>                           meanstructure <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           std.lv <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Plot the model</span></span>
<span><span class="co"># semPlot::semPaths(lavaanModel,</span></span>
<span><span class="co">#                   what = "est",</span></span>
<span><span class="co">#                   fade = FALSE)</span></span>
<span></span>
<span><span class="co">## Defining a custom penalty function is a bit more complicated than</span></span>
<span><span class="co"># using the default ones provided in regularizeSEM (see ?lessSEM::regularizeSEM).</span></span>
<span><span class="co"># We start with the definition of the penalty function. Make sure that the derivatives</span></span>
<span><span class="co"># of this function are well defined (i.e., the function is smooth)!</span></span>
<span><span class="co"># We will use the lasso penalty as an example.</span></span>
<span></span>
<span><span class="co"># The penalty function MUST accept three arguments; how you use them is up to you.</span></span>
<span></span>
<span><span class="co"># The first argument are the parameters. lessSEM will pass a vector with the current</span></span>
<span><span class="co"># parameter values and their names to your function. The parameter labels will be</span></span>
<span><span class="co"># exactly the same as those used by lavaan! So you can check them before with:</span></span>
<span></span>
<span><span class="fu">lessSEM</span><span class="fu">::</span><span class="fu"><a href="getLavaanParameters.html">getLavaanParameters</a></span><span class="op">(</span><span class="va">lavaanModel</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The vector passed to your function will look like the vector above.</span></span>
<span></span>
<span><span class="co"># The second argument is called tuningParameters MUST be a data.frame with the</span></span>
<span><span class="co"># tuning-parameters. lessSEM will automatically iterate over the rows of this object.</span></span>
<span><span class="co"># In case of LASSO regularization there is only one tuning parameter: lambda.</span></span>
<span><span class="co"># Therefore, we specify the tuningParameters object as:</span></span>
<span></span>
<span><span class="va">tuningParameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="co"># we will test 11 lambdas here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tuningParameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The third argument is called penaltyFunctionArguments and we can pass anything</span></span>
<span><span class="co"># we want here. For the lasso penalty, we need two additional things:</span></span>
<span><span class="co"># 1) We need the smoothing-parameter epsilon, which makes sure that our</span></span>
<span><span class="co"># penalty is differentiable</span></span>
<span><span class="co"># 2) We need the labels of the regularized parameters, so that we can only</span></span>
<span><span class="co"># penalize those while all others remain unpenalized.</span></span>
<span></span>
<span><span class="va">penaltyFunctionArguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  eps <span class="op">=</span> <span class="fl">1e-10</span>,</span>
<span>  regularizedParameterLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, it is time to specify our custom penalty function:</span></span>
<span></span>
<span><span class="va">smoothLASSO</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="co"># here are our three arguments:</span></span>
<span>  <span class="va">parameters</span>,</span>
<span>  <span class="va">tuningParameters</span>,</span>
<span>  <span class="va">penaltyFunctionArguments</span></span>
<span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># to make it easier to see what is going on:</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">tuningParameters</span><span class="op">$</span><span class="va">lambda</span> <span class="co"># tuningParameters will be ONE ROW OF the</span></span>
<span>  <span class="co"># tuningParameters object we created before -&gt; it will contain just</span></span>
<span>  <span class="co"># one lambda in this case!</span></span>
<span>  <span class="va">eps</span> <span class="op">&lt;-</span> <span class="va">penaltyFunctionArguments</span><span class="op">$</span><span class="va">eps</span></span>
<span>  <span class="va">regularizedParameterLabels</span> <span class="op">&lt;-</span> <span class="va">penaltyFunctionArguments</span><span class="op">$</span><span class="va">regularizedParameterLabels</span></span>
<span></span>
<span>  <span class="va">regularizedParameters</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="va">regularizedParameterLabels</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># now, let's define our penalty function:</span></span>
<span>  <span class="va">penaltyLasso</span> <span class="op">&lt;-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">regularizedParameters</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">eps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">penaltyLasso</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Important: This penalty function is assumed to be for a single individual only.</span></span>
<span><span class="co"># lessSEM will multiply it with sample size N to get the penalty value of the</span></span>
<span><span class="co"># full sample!</span></span>
<span></span>
<span><span class="co">#### Now we are ready to optimize! ####</span></span>
<span><span class="va">regsemApprox</span> <span class="op">&lt;-</span> <span class="fu">lessSEM</span><span class="fu">:::</span><span class="fu">.regularizeSEMWithCustomPenaltyRsolnp</span><span class="op">(</span>lavaanModel <span class="op">=</span> <span class="va">lavaanModel</span>,</span>
<span>                                               individualPenaltyFunction <span class="op">=</span> <span class="va">smoothLASSO</span>,</span>
<span>                                               tuningParameters <span class="op">=</span> <span class="va">tuningParameters</span>,</span>
<span>                                               penaltyFunctionArguments <span class="op">=</span> <span class="va">penaltyFunctionArguments</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let's compare the results to an exact optimization:</span></span>
<span></span>
<span><span class="va">regsemExact</span> <span class="op">&lt;-</span> <span class="fu"><a href="lasso.html">lasso</a></span><span class="op">(</span></span>
<span>  lavaanModel <span class="op">=</span> <span class="va">lavaanModel</span>,</span>
<span>  regularized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="va">tuningParameters</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">regsemExact</span><span class="op">@</span><span class="va">parameters</span><span class="op">[</span>,<span class="va">regsemExact</span><span class="op">@</span><span class="va">parameterLabels</span><span class="op">]</span> <span class="op">-</span></span>
<span>       <span class="va">regsemApprox</span><span class="op">@</span><span class="va">parameters</span><span class="op">[</span>,<span class="va">regsemExact</span><span class="op">@</span><span class="va">parameterLabels</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Note that the parameter estimates are basically identical.</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jannik H. Orzek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

